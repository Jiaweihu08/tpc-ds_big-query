{"status":{"state":"DONE"},"kind":"bigquery#job","statistics":{"totalSlotMs":"122358","creationTime":"1570972161003","totalBytesProcessed":"1120202380","startTime":"1570972161110","query":{"totalSlotMs":"122358","queryPlan":[{"readMsMax":"21","computeMsMax":"190","waitMsAvg":"1","id":"0","endMs":"1570972161644","waitMsMax":"1","startMs":"1570972161212","waitRatioMax":0.0001467351430667645,"readRatioAvg":0.0030814380044020544,"parallelInputs":"1","recordsRead":"102000","computeRatioAvg":0.027879677182685254,"writeMsAvg":"129","status":"COMPLETE","writeMsMax":"129","computeMsAvg":"190","shuffleOutputBytesSpilled":"0","writeRatioMax":0.01892883345561262,"readMsAvg":"21","waitRatioAvg":0.0001467351430667645,"completedParallelInputs":"1","computeRatioMax":0.027879677182685254,"name":"S00: Input","shuffleOutputBytes":"7999124","recordsWritten":"102000","readRatioMax":0.0030814380044020544,"steps":[{"kind":"READ","substeps":["$1:i_item_sk, $2:i_brand, $3:i_class, $4:i_category, $5:i_product_name","FROM item"]},{"kind":"WRITE","substeps":["$1, $2, $3, $4, $5","TO __stage00_output","BY HASH($1)"]}],"writeRatioAvg":0.01892883345561262},{"readMsMax":"11","computeMsMax":"9","waitMsAvg":"1","id":"1","endMs":"1570972161376","waitMsMax":"1","startMs":"1570972161302","waitRatioMax":0.0001467351430667645,"readRatioAvg":0.0016140865737344094,"parallelInputs":"1","recordsRead":"102","computeRatioAvg":0.0013206162876008803,"writeMsAvg":"8","status":"COMPLETE","writeMsMax":"8","computeMsAvg":"9","shuffleOutputBytesSpilled":"0","writeRatioMax":0.001173881144534116,"readMsAvg":"11","waitRatioAvg":0.0001467351430667645,"completedParallelInputs":"1","computeRatioMax":0.0013206162876008803,"name":"S01: Input","shuffleOutputBytes":"3060","recordsWritten":"102","readRatioMax":0.0016140865737344094,"steps":[{"kind":"READ","substeps":["$10:s_store_sk, $11:s_store_id","FROM store"]},{"kind":"WRITE","substeps":["$10, $11","TO __stage01_output","BY HASH($10)"]}],"writeRatioAvg":0.001173881144534116},{"readMsMax":"11","computeMsMax":"9","waitMsAvg":"26","id":"2","endMs":"1570972161424","waitMsMax":"26","startMs":"1570972161344","waitRatioMax":0.0038151137197358766,"readRatioAvg":0.0016140865737344094,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.0013206162876008803,"writeMsAvg":"7","status":"COMPLETE","writeMsMax":"7","computeMsAvg":"9","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0010271460014673515,"readMsAvg":"11","waitRatioAvg":0.0038151137197358766,"completedParallelInputs":"1","computeRatioMax":0.0013206162876008803,"name":"S02: Input","shuffleOutputBytes":"13140","recordsWritten":"365","readRatioMax":0.0016140865737344094,"steps":[{"kind":"READ","substeps":["$30:d_date_sk, $32:d_year, $33:d_moy, $34:d_qoy, $31:d_month_seq","FROM date_dim","WHERE between($31, 1181, 1192)"]},{"kind":"WRITE","substeps":["$30, $32, $33, $34","TO __stage02_output","BY HASH($30)"]}],"writeRatioAvg":0.0010271460014673515},{"readMsMax":"45","computeMsMax":"6815","inputStages":["0","1","2"],"waitMsAvg":"1","id":"5","endMs":"1570972165721","waitMsMax":"2","startMs":"1570972161723","waitRatioMax":0.000293470286133529,"readRatioAvg":0.0049889948642699924,"parallelInputs":"10","recordsRead":"29826782","computeRatioAvg":0.7947175348495965,"writeMsAvg":"24","status":"COMPLETE","writeMsMax":"39","computeMsAvg":"5416","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0057226705796038155,"readMsAvg":"34","waitRatioAvg":0.0001467351430667645,"completedParallelInputs":"10","computeRatioMax":1,"name":"S05: Join+","shuffleOutputBytes":"669989459","recordsWritten":"5304051","readRatioMax":0.006603081438004402,"steps":[{"kind":"READ","substeps":["$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_store_sk, $23:ss_quantity, $24:ss_sales_price","FROM store_sales"]},{"kind":"READ","substeps":["$30, $32, $33, $34","FROM __stage02_output"]},{"kind":"READ","substeps":["$10, $11","FROM __stage01_output"]},{"kind":"READ","substeps":["$1, $2, $3, $4, $5","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $110 := $108, $111 := $107, $112 := $106, $113 := $109, $114 := $103, $115 := $105, $116 := $104, $117 := $100","$60 := SUM($70)"]},{"kind":"COMPUTE","substeps":["$70 := coalesce(multiply($102, CAST($101 AS DOUBLE)), 0)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $90 = $1"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $81 = $10"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $20 = $30"]},{"kind":"WRITE","substeps":["$112, $111, $110, $113, $117, $114, $116, $115, $60","TO __stage05_output","BY HASH($110, $111, $112, $113, $114, $115, $116, $117)"]}],"writeRatioAvg":0.0035216434336023477},{"readMsMax":"0","computeMsMax":"4137","inputStages":["5"],"waitMsAvg":"1","id":"6","endMs":"1570972166109","waitMsMax":"1","startMs":"1570972164045","waitRatioMax":0.0001467351430667645,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"1643723","computeRatioAvg":0.6070432868672047,"writeMsAvg":"24","status":"COMPLETE","writeMsMax":"24","computeMsAvg":"4137","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0035216434336023477,"readMsAvg":"0","waitRatioAvg":0.0001467351430667645,"completedParallelInputs":"1","computeRatioMax":0.6070432868672047,"name":"S06: Repartition","shuffleOutputBytes":"207624077","recordsWritten":"1643723","readRatioMax":0,"steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"writeRatioAvg":0.0035216434336023477},{"readMsMax":"0","computeMsMax":"2858","inputStages":["6","5"],"waitMsAvg":"1","id":"7","endMs":"1570972168036","waitMsMax":"1","startMs":"1570972166283","waitRatioMax":0.0001467351430667645,"readRatioAvg":0,"parallelInputs":"10","recordsRead":"5304051","computeRatioAvg":0.36683785766691124,"writeMsAvg":"30","status":"COMPLETE","writeMsMax":"46","computeMsAvg":"2500","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0067498165810711665,"readMsAvg":"0","waitRatioAvg":0.0001467351430667645,"completedParallelInputs":"10","computeRatioMax":0.4193690388848129,"name":"S07: Aggregate","shuffleOutputBytes":"609424917","recordsWritten":"4824004","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$112, $111, $110, $113, $117, $114, $116, $115, $60","FROM __stage05_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $120 := $110, $121 := $111, $122 := $112, $123 := $113, $124 := $114, $125 := $115, $126 := $116, $127 := $117","$50 := SUM($60)"]},{"kind":"WRITE","substeps":["$122, $121, $120, $123, $127, $124, $126, $125, $50","TO __stage07_output","BY HASH($120, $121, $122, $123)"]}],"writeRatioAvg":0.004402054292002935},{"readMsMax":"0","computeMsMax":"4305","inputStages":["7"],"waitMsAvg":"3","id":"8","endMs":"1570972169454","waitMsMax":"3","startMs":"1570972167243","waitRatioMax":0.00044020542920029346,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"1759752","computeRatioAvg":0.6316947909024211,"writeMsAvg":"8","status":"COMPLETE","writeMsMax":"8","computeMsAvg":"4305","shuffleOutputBytesSpilled":"0","writeRatioMax":0.001173881144534116,"readMsAvg":"0","waitRatioAvg":0.00044020542920029346,"completedParallelInputs":"1","computeRatioMax":0.6316947909024211,"name":"S08: Repartition","shuffleOutputBytes":"222305882","recordsWritten":"1759752","readRatioMax":0,"steps":[{"kind":"READ","substeps":["FROM __stage07_output"]}],"writeRatioAvg":0.001173881144534116},{"readMsMax":"0","computeMsMax":"4153","inputStages":["8","7"],"waitMsAvg":"1","id":"9","endMs":"1570972171862","waitMsMax":"1","startMs":"1570972169467","waitRatioMax":0.0001467351430667645,"readRatioAvg":0,"parallelInputs":"10","recordsRead":"4824004","computeRatioAvg":0.5446808510638298,"writeMsAvg":"5","status":"COMPLETE","writeMsMax":"8","computeMsAvg":"3712","shuffleOutputBytesSpilled":"0","writeRatioMax":0.001173881144534116,"readMsAvg":"0","waitRatioAvg":0.0001467351430667645,"completedParallelInputs":"10","computeRatioMax":0.609391049156273,"name":"S09: Sort+","shuffleOutputBytes":"89891","recordsWritten":"1000","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$122, $121, $120, $123, $127, $124, $126, $125, $50","FROM __stage07_output"]},{"kind":"SORT","substeps":["$142 ASC, $141 ASC, $140 ASC, $143 ASC, $145 ASC, $147 ASC, $146 ASC, $144 ASC, $148 ASC, $40 ASC","LIMIT 100"]},{"kind":"FILTER","substeps":["less_or_equal($40, 100)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$40 := RANK() OVER (PARTITION BY $132, $131, $130, $133 ORDER BY $138 DESC)"]},{"kind":"SORT","substeps":["$120 ASC, $121 ASC, $122 ASC, $123 ASC, $50 DESC"]},{"kind":"WRITE","substeps":["$150, $151, $152, $153, $154, $155, $156, $157, $158, $159","TO __stage09_output"]}],"writeRatioAvg":0.0007336757153338225},{"readMsMax":"0","computeMsMax":"8","inputStages":["9"],"waitMsAvg":"1","id":"10","endMs":"1570972171902","waitMsMax":"1","startMs":"1570972169552","waitRatioMax":0.0001467351430667645,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"1000","computeRatioAvg":0.001173881144534116,"writeMsAvg":"12","status":"COMPLETE","writeMsMax":"12","computeMsAvg":"8","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0017608217168011738,"readMsAvg":"0","waitRatioAvg":0.0001467351430667645,"completedParallelInputs":"1","computeRatioMax":0.001173881144534116,"name":"S0A: Output","shuffleOutputBytes":"7000","recordsWritten":"100","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$150, $151, $152, $153, $154, $155, $156, $157, $158, $159","FROM __stage09_output"]},{"kind":"SORT","substeps":["$152 ASC, $151 ASC, $150 ASC, $153 ASC, $155 ASC, $157 ASC, $156 ASC, $154 ASC, $159 ASC, $158 ASC","LIMIT 100"]},{"kind":"WRITE","substeps":["$160, $161, $162, $163, $164, $165, $166, $167, $168, $169","TO __stage0A_output"]}],"writeRatioAvg":0.0017608217168011738}],"estimatedBytesProcessed":"1120202380","timeline":[{"totalSlotMs":"974","activeUnits":"0","completedUnits":"3","elapsedMs":"602","pendingUnits":"10"},{"totalSlotMs":"4642","activeUnits":"10","completedUnits":"3","elapsedMs":"1114","pendingUnits":"10"},{"totalSlotMs":"48960","activeUnits":"6","completedUnits":"12","elapsedMs":"3977","pendingUnits":"2"},{"totalSlotMs":"57628","activeUnits":"10","completedUnits":"14","elapsedMs":"5674","pendingUnits":"10"},{"totalSlotMs":"83496","activeUnits":"7","completedUnits":"24","elapsedMs":"7155","pendingUnits":"1"},{"totalSlotMs":"88836","activeUnits":"11","completedUnits":"25","elapsedMs":"8845","pendingUnits":"11"},{"totalSlotMs":"122358","activeUnits":"5","completedUnits":"36","elapsedMs":"11154","pendingUnits":"0"}],"statementType":"SELECT","totalBytesBilled":"1120927744","totalPartitionsProcessed":"0","totalBytesProcessed":"1120202380","cacheHit":false,"billingTier":1,"referencedTables":[{"projectId":"tpc-ds-2019","tableId":"date_dim","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"item","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"store","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"store_sales","datasetId":"scale_10"}]},"endTime":"1570972172285"},"jobReference":{"projectId":"tpc-ds-2019","location":"US","jobId":"query67_1570972159"},"etag":"mEsRhheKd3lPps2bSiox9w==","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tpc-ds-2019/jobs/query67_1570972159?location=US","configuration":{"query":{"maximumBillingTier":10,"defaultDataset":{"projectId":"tpc-ds-2019","datasetId":"scale_10"},"useLegacySql":false,"destinationTable":{"projectId":"tpc-ds-2019","tableId":"anon7904aaf2426efc6e5117bfae62f94777c1afe7f0","datasetId":"_0ca6f7c7da88564ba26827da43395a8255e28ecd"},"priority":"INTERACTIVE","writeDisposition":"WRITE_TRUNCATE","createDisposition":"CREATE_IF_NEEDED","query":"-- query67\nwith dw1 as (\n select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales\n from store_sales\n ,date_dim\n ,store\n ,item\n where ss_sold_date_sk=d_date_sk\n and ss_item_sk=i_item_sk\n and ss_store_sk = s_store_sk\n and d_month_seq between 1181 and 1181+11\n group by i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id\n), dw2 as (\n select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rank() over (partition by i_category, i_class, i_brand, i_product_name order by sumsales desc) rk\n from dw1\n), dw3 as (\n select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rank() over (partition by i_category order by sumsales desc) rk\n from dw2\n where rk <= 100\n)\nselect *\nfrom dw2\nwhere rk <= 100\norder by i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rk\nlimit 100\n;\n\n"},"jobType":"QUERY"},"id":"tpc-ds-2019:US.query67_1570972159","user_email":"nithish.sankaranarayanan@ulb.be"}
