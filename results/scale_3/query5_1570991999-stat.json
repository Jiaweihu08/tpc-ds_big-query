{"status":{"state":"DONE"},"kind":"bigquery#job","statistics":{"totalSlotMs":"405405","creationTime":"1570992001341","totalBytesProcessed":"18188039904","startTime":"1570992001614","query":{"totalSlotMs":"405405","queryPlan":[{"readMsMax":"21","computeMsMax":"7","waitMsAvg":"5","id":"0","endMs":"1570992001998","waitMsMax":"5","startMs":"1570992001875","waitRatioMax":0.0010645092612305727,"readRatioAvg":0.004470938897168405,"parallelInputs":"1","recordsRead":"24","computeRatioAvg":0.0014903129657228018,"writeMsAvg":"79","status":"COMPLETE","writeMsMax":"79","computeMsAvg":"7","shuffleOutputBytesSpilled":"0","writeRatioMax":0.016819246327443048,"readMsAvg":"21","waitRatioAvg":0.0010645092612305727,"completedParallelInputs":"1","computeRatioMax":0.0014903129657228018,"name":"S00: Input","shuffleOutputBytes":"720","recordsWritten":"24","readRatioMax":0.004470938897168405,"steps":[{"kind":"READ","substeps":["$20:web_site_sk, $21:web_site_id","FROM web_site"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage00_output","BY HASH($20)"]}],"writeRatioAvg":0.016819246327443048},{"readMsMax":"48","computeMsMax":"25","waitMsAvg":"16","id":"1","endMs":"1570992002037","waitMsMax":"16","startMs":"1570992001910","waitRatioMax":0.0034064296359378327,"readRatioAvg":0.010219288907813498,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.0053225463061528635,"writeMsAvg":"13","status":"COMPLETE","writeMsMax":"13","computeMsAvg":"25","shuffleOutputBytesSpilled":"0","writeRatioMax":0.002767724079199489,"readMsAvg":"48","waitRatioAvg":0.0034064296359378327,"completedParallelInputs":"1","computeRatioMax":0.0053225463061528635,"name":"S01: Input","shuffleOutputBytes":"135","recordsWritten":"15","readRatioMax":0.010219288907813498,"steps":[{"kind":"READ","substeps":["$50:d_date_sk, $51:d_date","FROM date_dim","WHERE between(CAST($51 AS DATE), 11921, 11935)"]},{"kind":"WRITE","substeps":["$50","TO __stage01_output","BY HASH($50)"]}],"writeRatioAvg":0.002767724079199489},{"readMsMax":"267","computeMsMax":"1081","waitMsAvg":"133","id":"2","endMs":"1570992003266","waitMsMax":"143","startMs":"1570992001965","waitRatioMax":0.03044496487119438,"readRatioAvg":0.03193527783691718,"parallelInputs":"92","recordsRead":"70474075","computeRatioAvg":0.17947626144347456,"writeMsAvg":"38","status":"COMPLETE","writeMsMax":"63","computeMsAvg":"843","shuffleOutputBytesSpilled":"0","writeRatioMax":0.013412816691505217,"readMsAvg":"150","waitRatioAvg":0.028315946348733235,"completedParallelInputs":"92","computeRatioMax":0.23014690227804982,"name":"S02: Input","shuffleOutputBytes":"1902659273","recordsWritten":"70474075","readRatioMax":0.056844794549712585,"steps":[{"kind":"READ","substeps":["$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number","FROM web_sales"]},{"kind":"WRITE","substeps":["$120, $121, $122","TO __stage02_output","BY HASH($120, $122)"]}],"writeRatioAvg":0.008090270385352353},{"readMsMax":"41","computeMsMax":"22","waitMsAvg":"17","id":"3","endMs":"1570992002063","waitMsMax":"17","startMs":"1570992001998","waitRatioMax":0.003619331488183947,"readRatioAvg":0.008728975942090697,"parallelInputs":"1","recordsRead":"20400","computeRatioAvg":0.00468384074941452,"writeMsAvg":"6","status":"COMPLETE","writeMsMax":"6","computeMsAvg":"22","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0012774111134766872,"readMsAvg":"41","waitRatioAvg":0.003619331488183947,"completedParallelInputs":"1","computeRatioMax":0.00468384074941452,"name":"S03: Input","shuffleOutputBytes":"612000","recordsWritten":"20400","readRatioMax":0.008728975942090697,"steps":[{"kind":"READ","substeps":["$10:cp_catalog_page_sk, $11:cp_catalog_page_id","FROM catalog_page"]},{"kind":"WRITE","substeps":["$10, $11","TO __stage03_output","BY HASH($10)"]}],"writeRatioAvg":0.0012774111134766872},{"readMsMax":"12","computeMsMax":"18","waitMsAvg":"2","id":"4","endMs":"1570992002085","waitMsMax":"2","startMs":"1570992001998","waitRatioMax":0.0004258037044922291,"readRatioAvg":0.0025548222269533745,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.0038322333404300617,"writeMsAvg":"7","status":"COMPLETE","writeMsMax":"7","computeMsAvg":"18","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0014903129657228018,"readMsAvg":"12","waitRatioAvg":0.0004258037044922291,"completedParallelInputs":"1","computeRatioMax":0.0038322333404300617,"name":"S04: Input","shuffleOutputBytes":"135","recordsWritten":"15","readRatioMax":0.0025548222269533745,"steps":[{"kind":"READ","substeps":["$40:d_date_sk, $41:d_date","FROM date_dim","WHERE between(CAST($41 AS DATE), 11921, 11935)"]},{"kind":"WRITE","substeps":["$40","TO __stage04_output","BY HASH($40)"]}],"writeRatioAvg":0.0014903129657228018},{"readMsMax":"72","computeMsMax":"5","waitMsAvg":"77","id":"6","endMs":"1570992002245","waitMsMax":"77","startMs":"1570992002107","waitRatioMax":0.01639344262295082,"readRatioAvg":0.015328933361720247,"parallelInputs":"1","recordsRead":"402","computeRatioAvg":0.0010645092612305727,"writeMsAvg":"4","status":"COMPLETE","writeMsMax":"4","computeMsAvg":"5","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0008516074089844582,"readMsAvg":"72","waitRatioAvg":0.01639344262295082,"completedParallelInputs":"1","computeRatioMax":0.0010645092612305727,"name":"S06: Input","shuffleOutputBytes":"12060","recordsWritten":"402","readRatioMax":0.015328933361720247,"steps":[{"kind":"READ","substeps":["$1:s_store_sk, $2:s_store_id","FROM store"]},{"kind":"WRITE","substeps":["$1, $2","TO __stage06_output","BY HASH($1)"]}],"writeRatioAvg":0.0008516074089844582},{"readMsMax":"10","computeMsMax":"16","waitMsAvg":"64","id":"7","endMs":"1570992002297","waitMsMax":"64","startMs":"1570992002107","waitRatioMax":0.01362571854375133,"readRatioAvg":0.0021290185224611454,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.0034064296359378327,"writeMsAvg":"6","status":"COMPLETE","writeMsMax":"6","computeMsAvg":"16","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0012774111134766872,"readMsAvg":"10","waitRatioAvg":0.01362571854375133,"completedParallelInputs":"1","computeRatioMax":0.0034064296359378327,"name":"S07: Input","shuffleOutputBytes":"135","recordsWritten":"15","readRatioMax":0.0021290185224611454,"steps":[{"kind":"READ","substeps":["$30:d_date_sk, $31:d_date","FROM date_dim","WHERE between(CAST($31 AS DATE), 11921, 11935)"]},{"kind":"WRITE","substeps":["$30","TO __stage07_output","BY HASH($30)"]}],"writeRatioAvg":0.0012774111134766872},{"readMsMax":"285","computeMsMax":"1579","inputStages":["3","4"],"waitMsAvg":"3","id":"9","endMs":"1570992003303","waitMsMax":"7","startMs":"1570992002118","waitRatioMax":0.0014903129657228018,"readRatioAvg":0.029806259314456036,"parallelInputs":"147","recordsRead":"158594852","computeRatioAvg":0.09836065573770492,"writeMsAvg":"3","status":"COMPLETE","writeMsMax":"10","computeMsAvg":"462","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0021290185224611454,"readMsAvg":"140","waitRatioAvg":0.0006387055567383436,"completedParallelInputs":"147","computeRatioMax":0.33617202469661484,"name":"S09: Join+","shuffleOutputBytes":"698526","recordsWritten":"12262","readRatioMax":0.06067702789014264,"steps":[{"kind":"READ","substeps":["$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit","FROM catalog_sales"]},{"kind":"READ","substeps":["$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss","FROM catalog_returns"]},{"kind":"READ","substeps":["$40","FROM __stage04_output"]},{"kind":"READ","substeps":["$10, $11","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $394","$230 := SUM($390)","$231 := SUM($391)","$232 := SUM($392)","$233 := SUM($393)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $380 = $10"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $261 = $40"]},{"kind":"COMPUTE","substeps":["$300 := 0"]},{"kind":"COMPUTE","substeps":["$310 := 0"]},{"kind":"WRITE","substeps":["$400, $230, $231, $232, $233","TO __stage09_output","BY HASH($400)"]}],"writeRatioAvg":0.0006387055567383436},{"readMsMax":"130","computeMsMax":"2078","inputStages":["6","7"],"waitMsAvg":"2","id":"10","endMs":"1570992003527","waitMsMax":"4","startMs":"1570992002339","waitRatioMax":0.0008516074089844582,"readRatioAvg":0.008303172237598468,"parallelInputs":"193","recordsRead":"310144733","computeRatioAvg":0.14732808175431125,"writeMsAvg":"7","status":"COMPLETE","writeMsMax":"110","computeMsAvg":"692","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0234192037470726,"readMsAvg":"39","waitRatioAvg":0.0004258037044922291,"completedParallelInputs":"193","computeRatioMax":0.44241004896742603,"name":"S0A: Join+","shuffleOutputBytes":"2209263","recordsWritten":"38759","readRatioMax":0.027677240791994892,"steps":[{"kind":"READ","substeps":["$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit","FROM store_sales"]},{"kind":"READ","substeps":["$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss","FROM store_returns"]},{"kind":"READ","substeps":["$30","FROM __stage07_output"]},{"kind":"READ","substeps":["$1, $2","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $360 := $354","$220 := SUM($350)","$221 := SUM($351)","$222 := SUM($352)","$223 := SUM($353)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $340 = $1"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $251 = $30"]},{"kind":"COMPUTE","substeps":["$280 := 0"]},{"kind":"COMPUTE","substeps":["$290 := 0"]},{"kind":"WRITE","substeps":["$360, $220, $221, $222, $223","TO __stage0A_output","BY HASH($360)"]}],"writeRatioAvg":0.0014903129657228018},{"readMsMax":"306","computeMsMax":"4697","waitMsAvg":"1","id":"11","endMs":"1570992005145","waitMsMax":"1","startMs":"1570992002353","waitRatioMax":0.00021290185224611454,"readRatioAvg":0.05876091121992762,"parallelInputs":"3","recordsRead":"7048438","computeRatioAvg":0.9195230998509687,"writeMsAvg":"25","status":"COMPLETE","writeMsMax":"37","computeMsAvg":"4319","shuffleOutputBytesSpilled":"0","writeRatioMax":0.007877368533106239,"readMsAvg":"276","waitRatioAvg":0.00021290185224611454,"completedParallelInputs":"3","computeRatioMax":1,"name":"S0B: Input","shuffleOutputBytes":"309540950","recordsWritten":"7048438","readRatioMax":0.06514796678731105,"steps":[{"kind":"READ","substeps":["$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss","FROM web_returns"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $114","TO __stage0B_output","BY HASH($111, $112)"]}],"writeRatioAvg":0.0053225463061528635},{"readMsMax":"200","computeMsMax":"1248","inputStages":["0","1","2","11"],"waitMsAvg":"4","id":"12","endMs":"1570992005978","waitMsMax":"10","startMs":"1570992005219","waitRatioMax":0.0021290185224611454,"readRatioAvg":0.010432190760059613,"parallelInputs":"192","recordsRead":"148004076","computeRatioAvg":0.12688950393868426,"writeMsAvg":"7","status":"COMPLETE","writeMsMax":"134","computeMsAvg":"596","shuffleOutputBytesSpilled":"0","writeRatioMax":0.02852884820097935,"readMsAvg":"49","waitRatioAvg":0.0008516074089844582,"completedParallelInputs":"192","computeRatioMax":0.265701511603151,"name":"S0C: Join+","shuffleOutputBytes":"131328","recordsWritten":"2304","readRatioMax":0.04258037044922291,"steps":[{"kind":"READ","substeps":["$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit","FROM web_sales"]},{"kind":"READ","substeps":["$110, $111, $112, $113, $114","FROM __stage0B_output"]},{"kind":"READ","substeps":["$120, $121, $122","FROM __stage02_output"]},{"kind":"READ","substeps":["$50","FROM __stage01_output"]},{"kind":"READ","substeps":["$20, $21","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $450 := $444","$240 := SUM($440)","$241 := SUM($441)","$242 := SUM($442)","$243 := SUM($443)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $430 = $20"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $271 = $50"]},{"kind":"COMPUTE","substeps":["$320 := 0"]},{"kind":"COMPUTE","substeps":["$330 := 0"]},{"kind":"JOIN","substeps":["LEFT OUTER HASH JOIN EACH WITH EACH ON $111 = $120, $112 = $122"]},{"kind":"WRITE","substeps":["$450, $240, $241, $242, $243","TO __stage0C_output","BY HASH($450)"]}],"writeRatioAvg":0.0014903129657228018},{"readMsMax":"0","computeMsMax":"16","inputStages":["10","9","12"],"waitMsAvg":"4","id":"13","endMs":"1570992006139","waitMsMax":"6","startMs":"1570992006028","waitRatioMax":0.0012774111134766872,"readRatioAvg":0,"parallelInputs":"51","recordsRead":"53325","computeRatioAvg":0.0019161166702150309,"writeMsAvg":"20","status":"COMPLETE","writeMsMax":"29","computeMsAvg":"9","shuffleOutputBytesSpilled":"0","writeRatioMax":0.006174153715137322,"readMsAvg":"0","waitRatioAvg":0.0008516074089844582,"completedParallelInputs":"51","computeRatioMax":0.0034064296359378327,"name":"S0D: Aggregate+","shuffleOutputBytes":"194407","recordsWritten":"2454","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$360, $220, $221, $222, $223","FROM __stage0A_output"]},{"kind":"READ","substeps":["$400, $230, $231, $232, $233","FROM __stage09_output"]},{"kind":"READ","substeps":["$450, $240, $241, $242, $243","FROM __stage0C_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $470 := $150, $471 := $151","$140 := SUM($152)","$141 := SUM($153)","$142 := SUM($154)"]},{"kind":"COMPUTE","substeps":["$160 := 'store channel'","$161 := concat('store', $370)","$162 := subtract($191, $193)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $370 := $360","$190 := SUM($220)","$191 := SUM($221)","$192 := SUM($222)","$193 := SUM($223)"]},{"kind":"COMPUTE","substeps":["$170 := 'catalog channel'","$171 := concat('catalog_page', $410)","$172 := subtract($201, $203)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$200 := SUM($230)","$201 := SUM($231)","$202 := SUM($232)","$203 := SUM($233)"]},{"kind":"COMPUTE","substeps":["$180 := 'web channel'","$181 := concat('web_site', $460)","$182 := subtract($211, $213)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $460 := $450","$210 := SUM($240)","$211 := SUM($241)","$212 := SUM($242)","$213 := SUM($243)"]},{"kind":"WRITE","substeps":["$140, $141, $142, $470, $471","TO __stage0D_output","BY HASH($470, $471)"]}],"writeRatioAvg":0.004258037044922291},{"readMsMax":"0","computeMsMax":"6","inputStages":["13"],"waitMsAvg":"3","id":"14","endMs":"1570992006331","waitMsMax":"4","startMs":"1570992006152","waitRatioMax":0.0008516074089844582,"readRatioAvg":0,"parallelInputs":"5","recordsRead":"2454","computeRatioAvg":0.0010645092612305727,"writeMsAvg":"88","status":"COMPLETE","writeMsMax":"146","computeMsAvg":"5","shuffleOutputBytesSpilled":"0","writeRatioMax":0.031083670427932725,"readMsAvg":"0","waitRatioAvg":0.0006387055567383436,"completedParallelInputs":"5","computeRatioMax":0.0012774111134766872,"name":"S0E: Sort+","shuffleOutputBytes":"39992","recordsWritten":"500","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$140, $141, $142, $470, $471","FROM __stage0D_output"]},{"kind":"SORT","substeps":["$480 ASC, $481 ASC","LIMIT 100"]},{"kind":"AGGREGATE","substeps":["GROUP BY $480 := $470, $481 := $471","$130 := SUM($140)","$131 := SUM($141)","$132 := SUM($142)"]},{"kind":"WRITE","substeps":["$490, $491, $492, $493, $494","TO __stage0E_output"]}],"writeRatioAvg":0.01873536299765808},{"readMsMax":"0","computeMsMax":"7","inputStages":["14"],"waitMsAvg":"3","id":"15","endMs":"1570992006344","waitMsMax":"3","startMs":"1570992006243","waitRatioMax":0.0006387055567383436,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"500","computeRatioAvg":0.0014903129657228018,"writeMsAvg":"6","status":"COMPLETE","writeMsMax":"6","computeMsAvg":"7","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0012774111134766872,"readMsAvg":"0","waitRatioAvg":0.0006387055567383436,"completedParallelInputs":"1","computeRatioMax":0.0014903129657228018,"name":"S0F: Output","shuffleOutputBytes":"8000","recordsWritten":"100","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$490, $491, $492, $493, $494","FROM __stage0E_output"]},{"kind":"SORT","substeps":["$493 ASC, $494 ASC","LIMIT 100"]},{"kind":"WRITE","substeps":["$500, $501, $502, $503, $504","TO __stage0F_output"]}],"writeRatioAvg":0.0012774111134766872}],"estimatedBytesProcessed":"18188039904","timeline":[{"totalSlotMs":"19033","activeUnits":"435","completedUnits":"6","elapsedMs":"763","pendingUnits":"435"},{"totalSlotMs":"286232","activeUnits":"55","completedUnits":"435","elapsedMs":"1798","pendingUnits":"6"},{"totalSlotMs":"288806","activeUnits":"3","completedUnits":"438","elapsedMs":"2345","pendingUnits":"3"},{"totalSlotMs":"374593","activeUnits":"64","completedUnits":"570","elapsedMs":"4113","pendingUnits":"63"},{"totalSlotMs":"405405","activeUnits":"5","completedUnits":"690","elapsedMs":"4930","pendingUnits":"0"}],"statementType":"SELECT","totalBytesBilled":"18188599296","totalPartitionsProcessed":"0","totalBytesProcessed":"18188039904","cacheHit":false,"billingTier":1,"referencedTables":[{"projectId":"tpc-ds-2019","tableId":"web_returns","datasetId":"scale_100"},{"projectId":"tpc-ds-2019","tableId":"catalog_returns","datasetId":"scale_100"},{"projectId":"tpc-ds-2019","tableId":"date_dim","datasetId":"scale_100"},{"projectId":"tpc-ds-2019","tableId":"store_sales","datasetId":"scale_100"},{"projectId":"tpc-ds-2019","tableId":"web_site","datasetId":"scale_100"},{"projectId":"tpc-ds-2019","tableId":"catalog_page","datasetId":"scale_100"},{"projectId":"tpc-ds-2019","tableId":"web_sales","datasetId":"scale_100"},{"projectId":"tpc-ds-2019","tableId":"catalog_sales","datasetId":"scale_100"},{"projectId":"tpc-ds-2019","tableId":"store","datasetId":"scale_100"},{"projectId":"tpc-ds-2019","tableId":"store_returns","datasetId":"scale_100"}]},"endTime":"1570992006851"},"jobReference":{"projectId":"tpc-ds-2019","location":"US","jobId":"query5_1570991999"},"etag":"eqi7Czn+6+yqxAVaqrKjJg==","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tpc-ds-2019/jobs/query5_1570991999?location=US","configuration":{"query":{"maximumBillingTier":10,"defaultDataset":{"projectId":"tpc-ds-2019","datasetId":"scale_100"},"useLegacySql":false,"destinationTable":{"projectId":"tpc-ds-2019","tableId":"anon643edbd19d3721d3c40f9a8b5b7c8aca52d3a0f9","datasetId":"_0ca6f7c7da88564ba26827da43395a8255e28ecd"},"priority":"INTERACTIVE","writeDisposition":"WRITE_TRUNCATE","createDisposition":"CREATE_IF_NEEDED","query":"-- query5\nWITH ssr AS \n( \n SELECT s_store_id, \n Sum(sales_price) AS sales, \n Sum(profit) AS profit, \n Sum(return_amt) AS returns1, \n Sum(net_loss) AS profit_loss \n FROM ( \n SELECT ss_store_sk AS store_sk, \n ss_sold_date_sk AS date_sk, \n ss_ext_sales_price AS sales_price, \n ss_net_profit AS profit, \n 0 AS return_amt, \n 0 AS net_loss \n FROM store_sales \n UNION ALL \n SELECT sr_store_sk AS store_sk, \n sr_returned_date_sk AS date_sk, \n 0 AS sales_price, \n 0 AS profit, \n sr_return_amt AS return_amt, \n sr_net_loss AS net_loss \n FROM store_returns ) salesreturns, \n date_dim, \n store \n WHERE date_sk = d_date_sk \n AND Cast(d_date AS DATE) BETWEEN Cast('2002-08-22' AS DATE) AND ( \n Cast('2002-09-05' AS DATE)) \n AND store_sk = s_store_sk \n GROUP BY s_store_id) , csr AS \n( \n SELECT cp_catalog_page_id, \n sum(sales_price) AS sales, \n sum(profit) AS profit, \n sum(return_amt) AS returns1, \n sum(net_loss) AS profit_loss \n FROM ( \n SELECT cs_catalog_page_sk AS page_sk, \n cs_sold_date_sk AS date_sk, \n cs_ext_sales_price AS sales_price, \n cs_net_profit AS profit, \n 0 AS return_amt, \n 0 AS net_loss \n FROM catalog_sales \n UNION ALL \n SELECT cr_catalog_page_sk AS page_sk, \n cr_returned_date_sk AS date_sk, \n 0 AS sales_price, \n 0 AS profit, \n cr_return_amount AS return_amt, \n cr_net_loss AS net_loss \n FROM catalog_returns ) salesreturns, \n date_dim, \n catalog_page \n WHERE date_sk = d_date_sk \n AND Cast(d_date AS DATE) BETWEEN cast('2002-08-22' AS date) AND ( \n Cast('2002-09-05' AS DATE)) \n AND page_sk = cp_catalog_page_sk \n GROUP BY cp_catalog_page_id) , wsr AS \n( \n SELECT web_site_id, \n sum(sales_price) AS sales, \n sum(profit) AS profit, \n sum(return_amt) AS returns1, \n sum(net_loss) AS profit_loss \n FROM ( \n SELECT ws_web_site_sk AS wsr_web_site_sk, \n ws_sold_date_sk AS date_sk, \n ws_ext_sales_price AS sales_price, \n ws_net_profit AS profit, \n 0 AS return_amt, \n 0 AS net_loss \n FROM web_sales \n UNION ALL \n SELECT ws_web_site_sk AS wsr_web_site_sk, \n wr_returned_date_sk AS date_sk, \n 0 AS sales_price, \n 0 AS profit, \n wr_return_amt AS return_amt, \n wr_net_loss AS net_loss \n FROM web_returns \n LEFT OUTER JOIN web_sales \n ON ( \n wr_item_sk = ws_item_sk \n AND wr_order_number = ws_order_number) ) salesreturns,\n date_dim, \n web_site \n WHERE date_sk = d_date_sk \n AND Cast(d_date AS DATE) BETWEEN cast('2002-08-22' AS date) AND ( \n Cast('2002-09-05' AS DATE)) \n AND wsr_web_site_sk = web_site_sk \n GROUP BY web_site_id) \nSELECT \n channel , \n id , \n sum(sales) AS sales , \n sum(returns1) AS returns1 , \n sum(profit) AS profit \nFROM ( \n SELECT 'store channel' AS channel , \n Concat('store', s_store_id) AS id , \n sales , \n returns1 , \n (profit - profit_loss) AS profit \n FROM ssr \n UNION ALL \n SELECT 'catalog channel' AS channel , \n Concat('catalog_page', cp_catalog_page_id) AS id , \n sales , \n returns1 , \n (profit - profit_loss) AS profit \n FROM csr \n UNION ALL \n SELECT 'web channel' AS channel , \n Concat('web_site', web_site_id) AS id , \n sales , \n returns1 , \n (profit - profit_loss) AS profit \n FROM wsr ) x \nGROUP BY channel, id\nORDER BY channel , \n id \nLIMIT 100; \n\n"},"jobType":"QUERY"},"id":"tpc-ds-2019:US.query5_1570991999","user_email":"nithish.sankaranarayanan@ulb.be"}
