{"status":{"state":"DONE"},"kind":"bigquery#job","statistics":{"totalSlotMs":"53150","creationTime":"1570971364610","totalBytesProcessed":"1848838884","startTime":"1570971364821","query":{"totalSlotMs":"53150","queryPlan":[{"readMsMax":"20","computeMsMax":"5","waitMsAvg":"1","id":"0","endMs":"1570971365177","waitMsMax":"1","startMs":"1570971365132","waitRatioMax":0.00042589437819420784,"readRatioAvg":0.008517887563884156,"parallelInputs":"1","recordsRead":"42","computeRatioAvg":0.002129471890971039,"writeMsAvg":"5","status":"COMPLETE","writeMsMax":"5","computeMsAvg":"5","shuffleOutputBytesSpilled":"0","writeRatioMax":0.002129471890971039,"readMsAvg":"20","waitRatioAvg":0.00042589437819420784,"completedParallelInputs":"1","computeRatioMax":0.002129471890971039,"name":"S00: Input","shuffleOutputBytes":"1260","recordsWritten":"42","readRatioMax":0.008517887563884156,"steps":[{"kind":"READ","substeps":["$20:web_site_sk, $21:web_site_id","FROM web_site"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage00_output","BY HASH($20)"]}],"writeRatioAvg":0.002129471890971039},{"readMsMax":"48","computeMsMax":"20","waitMsAvg":"29","id":"1","endMs":"1570971365266","waitMsMax":"29","startMs":"1570971365175","waitRatioMax":0.012350936967632026,"readRatioAvg":0.020442930153321975,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.008517887563884156,"writeMsAvg":"4","status":"COMPLETE","writeMsMax":"4","computeMsAvg":"20","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0017035775127768314,"readMsAvg":"48","waitRatioAvg":0.012350936967632026,"completedParallelInputs":"1","computeRatioMax":0.008517887563884156,"name":"S01: Input","shuffleOutputBytes":"135","recordsWritten":"15","readRatioMax":0.020442930153321975,"steps":[{"kind":"READ","substeps":["$50:d_date_sk, $51:d_date","FROM date_dim","WHERE between(CAST($51 AS DATE), 11921, 11935)"]},{"kind":"WRITE","substeps":["$50","TO __stage01_output","BY HASH($50)"]}],"writeRatioAvg":0.0017035775127768314},{"readMsMax":"199","computeMsMax":"2348","waitMsAvg":"47","id":"2","endMs":"1570971366519","waitMsMax":"58","startMs":"1570971365177","waitRatioMax":0.024701873935264053,"readRatioAvg":0.07367972742759796,"parallelInputs":"4","recordsRead":"7201030","computeRatioAvg":0.9395229982964225,"writeMsAvg":"25","status":"COMPLETE","writeMsMax":"28","computeMsAvg":"2206","shuffleOutputBytesSpilled":"0","writeRatioMax":0.01192504258943782,"readMsAvg":"173","waitRatioAvg":0.02001703577512777,"completedParallelInputs":"4","computeRatioMax":1,"name":"S02: Input","shuffleOutputBytes":"194413626","recordsWritten":"7201030","readRatioMax":0.08475298126064736,"steps":[{"kind":"READ","substeps":["$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number","FROM web_sales"]},{"kind":"WRITE","substeps":["$120, $121, $122","TO __stage02_output","BY HASH($120, $122)"]}],"writeRatioAvg":0.010647359454855196},{"readMsMax":"35","computeMsMax":"20","waitMsAvg":"41","id":"3","endMs":"1570971365435","waitMsMax":"41","startMs":"1570971365218","waitRatioMax":0.01746166950596252,"readRatioAvg":0.014906303236797274,"parallelInputs":"1","recordsRead":"12000","computeRatioAvg":0.008517887563884156,"writeMsAvg":"7","status":"COMPLETE","writeMsMax":"7","computeMsAvg":"20","shuffleOutputBytesSpilled":"0","writeRatioMax":0.002981260647359455,"readMsAvg":"35","waitRatioAvg":0.01746166950596252,"completedParallelInputs":"1","computeRatioMax":0.008517887563884156,"name":"S03: Input","shuffleOutputBytes":"360000","recordsWritten":"12000","readRatioMax":0.014906303236797274,"steps":[{"kind":"READ","substeps":["$10:cp_catalog_page_sk, $11:cp_catalog_page_id","FROM catalog_page"]},{"kind":"WRITE","substeps":["$10, $11","TO __stage03_output","BY HASH($10)"]}],"writeRatioAvg":0.002981260647359455},{"readMsMax":"12","computeMsMax":"24","waitMsAvg":"23","id":"4","endMs":"1570971365432","waitMsMax":"23","startMs":"1570971365219","waitRatioMax":0.009795570698466781,"readRatioAvg":0.005110732538330494,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.010221465076660987,"writeMsAvg":"7","status":"COMPLETE","writeMsMax":"7","computeMsAvg":"24","shuffleOutputBytesSpilled":"0","writeRatioMax":0.002981260647359455,"readMsAvg":"12","waitRatioAvg":0.009795570698466781,"completedParallelInputs":"1","computeRatioMax":0.010221465076660987,"name":"S04: Input","shuffleOutputBytes":"135","recordsWritten":"15","readRatioMax":0.005110732538330494,"steps":[{"kind":"READ","substeps":["$40:d_date_sk, $41:d_date","FROM date_dim","WHERE between(CAST($41 AS DATE), 11921, 11935)"]},{"kind":"WRITE","substeps":["$40","TO __stage04_output","BY HASH($40)"]}],"writeRatioAvg":0.002981260647359455},{"readMsMax":"31","computeMsMax":"6","waitMsAvg":"1","id":"6","endMs":"1570971365336","waitMsMax":"1","startMs":"1570971365228","waitRatioMax":0.00042589437819420784,"readRatioAvg":0.013202725724020443,"parallelInputs":"1","recordsRead":"102","computeRatioAvg":0.002555366269165247,"writeMsAvg":"55","status":"COMPLETE","writeMsMax":"55","computeMsAvg":"6","shuffleOutputBytesSpilled":"0","writeRatioMax":0.023424190800681432,"readMsAvg":"31","waitRatioAvg":0.00042589437819420784,"completedParallelInputs":"1","computeRatioMax":0.002555366269165247,"name":"S06: Input","shuffleOutputBytes":"3060","recordsWritten":"102","readRatioMax":0.013202725724020443,"steps":[{"kind":"READ","substeps":["$1:s_store_sk, $2:s_store_id","FROM store"]},{"kind":"WRITE","substeps":["$1, $2","TO __stage06_output","BY HASH($1)"]}],"writeRatioAvg":0.023424190800681432},{"readMsMax":"12","computeMsMax":"19","waitMsAvg":"1","id":"7","endMs":"1570971365365","waitMsMax":"1","startMs":"1570971365320","waitRatioMax":0.00042589437819420784,"readRatioAvg":0.005110732538330494,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.008091993185689948,"writeMsAvg":"9","status":"COMPLETE","writeMsMax":"9","computeMsAvg":"19","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0038330494037478705,"readMsAvg":"12","waitRatioAvg":0.00042589437819420784,"completedParallelInputs":"1","computeRatioMax":0.008091993185689948,"name":"S07: Input","shuffleOutputBytes":"135","recordsWritten":"15","readRatioMax":0.005110732538330494,"steps":[{"kind":"READ","substeps":["$30:d_date_sk, $31:d_date","FROM date_dim","WHERE between(CAST($31 AS DATE), 11921, 11935)"]},{"kind":"WRITE","substeps":["$30","TO __stage07_output","BY HASH($30)"]}],"writeRatioAvg":0.0038330494037478705},{"readMsMax":"181","computeMsMax":"1364","inputStages":["6","7"],"waitMsAvg":"1","id":"9","endMs":"1570971366426","waitMsMax":"1","startMs":"1570971365386","waitRatioMax":0.00042589437819420784,"readRatioAvg":0.05238500851788756,"parallelInputs":"11","recordsRead":"31681729","computeRatioAvg":0.4804088586030664,"writeMsAvg":"5","status":"COMPLETE","writeMsMax":"16","computeMsAvg":"1128","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0068143100511073255,"readMsAvg":"123","waitRatioAvg":0.00042589437819420784,"completedParallelInputs":"11","computeRatioMax":0.5809199318568995,"name":"S09: Join+","shuffleOutputBytes":"31977","recordsWritten":"561","readRatioMax":0.07708688245315162,"steps":[{"kind":"READ","substeps":["$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit","FROM store_sales"]},{"kind":"READ","substeps":["$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss","FROM store_returns"]},{"kind":"READ","substeps":["$30","FROM __stage07_output"]},{"kind":"READ","substeps":["$1, $2","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $360 := $354","$220 := SUM($350)","$221 := SUM($351)","$222 := SUM($352)","$223 := SUM($353)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $340 = $1"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $251 = $30"]},{"kind":"COMPUTE","substeps":["$280 := 0"]},{"kind":"COMPUTE","substeps":["$290 := 0"]},{"kind":"WRITE","substeps":["$360, $220, $221, $222, $223","TO __stage09_output","BY HASH($360)"]}],"writeRatioAvg":0.002129471890971039},{"readMsMax":"183","computeMsMax":"1028","inputStages":["3","4"],"waitMsAvg":"1","id":"11","endMs":"1570971366202","waitMsMax":"2","startMs":"1570971365508","waitRatioMax":0.0008517887563884157,"readRatioAvg":0.03747870528109029,"parallelInputs":"9","recordsRead":"15945260","computeRatioAvg":0.35604770017035775,"writeMsAvg":"7","status":"COMPLETE","writeMsMax":"14","computeMsAvg":"836","shuffleOutputBytesSpilled":"0","writeRatioMax":0.00596252129471891,"readMsAvg":"88","waitRatioAvg":0.00042589437819420784,"completedParallelInputs":"9","computeRatioMax":0.43781942078364566,"name":"S0B: Join+","shuffleOutputBytes":"209965","recordsWritten":"3685","readRatioMax":0.07793867120954004,"steps":[{"kind":"READ","substeps":["$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit","FROM catalog_sales"]},{"kind":"READ","substeps":["$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss","FROM catalog_returns"]},{"kind":"READ","substeps":["$40","FROM __stage04_output"]},{"kind":"READ","substeps":["$10, $11","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $394","$230 := SUM($390)","$231 := SUM($391)","$232 := SUM($392)","$233 := SUM($393)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $380 = $10"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $261 = $40"]},{"kind":"COMPUTE","substeps":["$300 := 0"]},{"kind":"COMPUTE","substeps":["$310 := 0"]},{"kind":"WRITE","substeps":["$400, $230, $231, $232, $233","TO __stage0B_output","BY HASH($400)"]}],"writeRatioAvg":0.002981260647359455},{"readMsMax":"297","computeMsMax":"1776","waitMsAvg":"1","id":"12","endMs":"1570971367218","waitMsMax":"1","startMs":"1570971365931","waitRatioMax":0.00042589437819420784,"readRatioAvg":0.12649063032367971,"parallelInputs":"1","recordsRead":"720202","computeRatioAvg":0.7563884156729132,"writeMsAvg":"40","status":"COMPLETE","writeMsMax":"40","computeMsAvg":"1776","shuffleOutputBytesSpilled":"0","writeRatioMax":0.017035775127768313,"readMsAvg":"297","waitRatioAvg":0.00042589437819420784,"completedParallelInputs":"1","computeRatioMax":0.7563884156729132,"name":"S0C: Input","shuffleOutputBytes":"31631330","recordsWritten":"720202","readRatioMax":0.12649063032367971,"steps":[{"kind":"READ","substeps":["$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss","FROM web_returns"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $114","TO __stage0C_output","BY HASH($111, $112)"]}],"writeRatioAvg":0.017035775127768313},{"readMsMax":"135","computeMsMax":"863","inputStages":["0","1","2","12"],"waitMsAvg":"2","id":"13","endMs":"1570971368000","waitMsMax":"3","startMs":"1570971367432","waitRatioMax":0.0012776831345826234,"readRatioAvg":0.0012776831345826234,"parallelInputs":"104","recordsRead":"15128190","computeRatioAvg":0.04045996592844974,"writeMsAvg":"6","status":"COMPLETE","writeMsMax":"32","computeMsAvg":"95","shuffleOutputBytesSpilled":"0","writeRatioMax":0.013628620102214651,"readMsAvg":"3","waitRatioAvg":0.0008517887563884157,"completedParallelInputs":"104","computeRatioMax":0.36754684838160134,"name":"S0D: Join+","shuffleOutputBytes":"115110","recordsWritten":"2022","readRatioMax":0.05749574105621806,"steps":[{"kind":"READ","substeps":["$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit","FROM web_sales"]},{"kind":"READ","substeps":["$110, $111, $112, $113, $114","FROM __stage0C_output"]},{"kind":"READ","substeps":["$120, $121, $122","FROM __stage02_output"]},{"kind":"READ","substeps":["$50","FROM __stage01_output"]},{"kind":"READ","substeps":["$20, $21","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $450 := $444","$240 := SUM($440)","$241 := SUM($441)","$242 := SUM($442)","$243 := SUM($443)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $430 = $20"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $271 = $50"]},{"kind":"COMPUTE","substeps":["$320 := 0"]},{"kind":"COMPUTE","substeps":["$330 := 0"]},{"kind":"JOIN","substeps":["LEFT OUTER HASH JOIN EACH WITH EACH ON $111 = $120, $112 = $122"]},{"kind":"WRITE","substeps":["$450, $240, $241, $242, $243","TO __stage0D_output","BY HASH($450)"]}],"writeRatioAvg":0.002555366269165247},{"readMsMax":"0","computeMsMax":"13","inputStages":["9","11","13"],"waitMsAvg":"1","id":"14","endMs":"1570971368163","waitMsMax":"1","startMs":"1570971368052","waitRatioMax":0.00042589437819420784,"readRatioAvg":0,"parallelInputs":"3","recordsRead":"6268","computeRatioAvg":0.004258943781942078,"writeMsAvg":"23","status":"COMPLETE","writeMsMax":"40","computeMsAvg":"10","shuffleOutputBytesSpilled":"0","writeRatioMax":0.017035775127768313,"readMsAvg":"0","waitRatioAvg":0.00042589437819420784,"completedParallelInputs":"3","computeRatioMax":0.005536626916524702,"name":"S0E: Aggregate+","shuffleOutputBytes":"93053","recordsWritten":"1172","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$360, $220, $221, $222, $223","FROM __stage09_output"]},{"kind":"READ","substeps":["$400, $230, $231, $232, $233","FROM __stage0B_output"]},{"kind":"READ","substeps":["$450, $240, $241, $242, $243","FROM __stage0D_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $470 := $150, $471 := $151","$140 := SUM($152)","$141 := SUM($153)","$142 := SUM($154)"]},{"kind":"COMPUTE","substeps":["$160 := 'store channel'","$161 := concat('store', $370)","$162 := subtract($191, $193)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $370 := $360","$190 := SUM($220)","$191 := SUM($221)","$192 := SUM($222)","$193 := SUM($223)"]},{"kind":"COMPUTE","substeps":["$170 := 'catalog channel'","$171 := concat('catalog_page', $410)","$172 := subtract($201, $203)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$200 := SUM($230)","$201 := SUM($231)","$202 := SUM($232)","$203 := SUM($233)"]},{"kind":"COMPUTE","substeps":["$180 := 'web channel'","$181 := concat('web_site', $460)","$182 := subtract($211, $213)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $460 := $450","$210 := SUM($240)","$211 := SUM($241)","$212 := SUM($242)","$213 := SUM($243)"]},{"kind":"WRITE","substeps":["$140, $141, $142, $470, $471","TO __stage0E_output","BY HASH($470, $471)"]}],"writeRatioAvg":0.009795570698466781},{"readMsMax":"0","computeMsMax":"5","inputStages":["14"],"waitMsAvg":"1","id":"15","endMs":"1570971368312","waitMsMax":"1","startMs":"1570971368165","waitRatioMax":0.00042589437819420784,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"1172","computeRatioAvg":0.002129471890971039,"writeMsAvg":"136","status":"COMPLETE","writeMsMax":"136","computeMsAvg":"5","shuffleOutputBytesSpilled":"0","writeRatioMax":0.05792163543441227,"readMsAvg":"0","waitRatioAvg":0.00042589437819420784,"completedParallelInputs":"1","computeRatioMax":0.002129471890971039,"name":"S0F: Sort+","shuffleOutputBytes":"8000","recordsWritten":"100","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$140, $141, $142, $470, $471","FROM __stage0E_output"]},{"kind":"SORT","substeps":["$480 ASC, $481 ASC","LIMIT 100"]},{"kind":"AGGREGATE","substeps":["GROUP BY $480 := $470, $481 := $471","$130 := SUM($140)","$131 := SUM($141)","$132 := SUM($142)"]},{"kind":"WRITE","substeps":["$490, $491, $492, $493, $494","TO __stage0F_output"]}],"writeRatioAvg":0.05792163543441227},{"readMsMax":"0","computeMsMax":"5","inputStages":["15"],"waitMsAvg":"35","id":"16","endMs":"1570971368476","waitMsMax":"35","startMs":"1570971368297","waitRatioMax":0.014906303236797274,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"100","computeRatioAvg":0.002129471890971039,"writeMsAvg":"155","status":"COMPLETE","writeMsMax":"155","computeMsAvg":"5","shuffleOutputBytesSpilled":"0","writeRatioMax":0.06601362862010221,"readMsAvg":"0","waitRatioAvg":0.014906303236797274,"completedParallelInputs":"1","computeRatioMax":0.002129471890971039,"name":"S10: Output","shuffleOutputBytes":"8000","recordsWritten":"100","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$490, $491, $492, $493, $494","FROM __stage0F_output"]},{"kind":"SORT","substeps":["$493 ASC, $494 ASC","LIMIT 100"]},{"kind":"WRITE","substeps":["$500, $501, $502, $503, $504","TO __stage10_output"]}],"writeRatioAvg":0.06601362862010221}],"estimatedBytesProcessed":"1848838884","timeline":[{"totalSlotMs":"3642","activeUnits":"24","completedUnits":"6","elapsedMs":"812","pendingUnits":"24"},{"totalSlotMs":"33554","activeUnits":"4","completedUnits":"30","elapsedMs":"2161","pendingUnits":"1"},{"totalSlotMs":"53150","activeUnits":"12","completedUnits":"140","elapsedMs":"3835","pendingUnits":"0"}],"statementType":"SELECT","totalBytesBilled":"1849688064","totalPartitionsProcessed":"0","totalBytesProcessed":"1848838884","cacheHit":false,"billingTier":1,"referencedTables":[{"projectId":"tpc-ds-2019","tableId":"date_dim","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"web_sales","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"catalog_sales","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"store_returns","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"catalog_returns","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"web_site","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"store","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"store_sales","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"catalog_page","datasetId":"scale_10"},{"projectId":"tpc-ds-2019","tableId":"web_returns","datasetId":"scale_10"}]},"endTime":"1570971368688"},"jobReference":{"projectId":"tpc-ds-2019","location":"US","jobId":"query5_1570971363"},"etag":"3wDRl9ydwDHZwgll6UShPQ==","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tpc-ds-2019/jobs/query5_1570971363?location=US","configuration":{"query":{"maximumBillingTier":10,"defaultDataset":{"projectId":"tpc-ds-2019","datasetId":"scale_10"},"useLegacySql":false,"destinationTable":{"projectId":"tpc-ds-2019","tableId":"anon42dc72f1ca4e93e3c63ad7748b8a80a3ba75a1d8","datasetId":"_0ca6f7c7da88564ba26827da43395a8255e28ecd"},"priority":"INTERACTIVE","writeDisposition":"WRITE_TRUNCATE","createDisposition":"CREATE_IF_NEEDED","query":"-- query5\nWITH ssr AS \n( \n SELECT s_store_id, \n Sum(sales_price) AS sales, \n Sum(profit) AS profit, \n Sum(return_amt) AS returns1, \n Sum(net_loss) AS profit_loss \n FROM ( \n SELECT ss_store_sk AS store_sk, \n ss_sold_date_sk AS date_sk, \n ss_ext_sales_price AS sales_price, \n ss_net_profit AS profit, \n 0 AS return_amt, \n 0 AS net_loss \n FROM store_sales \n UNION ALL \n SELECT sr_store_sk AS store_sk, \n sr_returned_date_sk AS date_sk, \n 0 AS sales_price, \n 0 AS profit, \n sr_return_amt AS return_amt, \n sr_net_loss AS net_loss \n FROM store_returns ) salesreturns, \n date_dim, \n store \n WHERE date_sk = d_date_sk \n AND Cast(d_date AS DATE) BETWEEN Cast('2002-08-22' AS DATE) AND ( \n Cast('2002-09-05' AS DATE)) \n AND store_sk = s_store_sk \n GROUP BY s_store_id) , csr AS \n( \n SELECT cp_catalog_page_id, \n sum(sales_price) AS sales, \n sum(profit) AS profit, \n sum(return_amt) AS returns1, \n sum(net_loss) AS profit_loss \n FROM ( \n SELECT cs_catalog_page_sk AS page_sk, \n cs_sold_date_sk AS date_sk, \n cs_ext_sales_price AS sales_price, \n cs_net_profit AS profit, \n 0 AS return_amt, \n 0 AS net_loss \n FROM catalog_sales \n UNION ALL \n SELECT cr_catalog_page_sk AS page_sk, \n cr_returned_date_sk AS date_sk, \n 0 AS sales_price, \n 0 AS profit, \n cr_return_amount AS return_amt, \n cr_net_loss AS net_loss \n FROM catalog_returns ) salesreturns, \n date_dim, \n catalog_page \n WHERE date_sk = d_date_sk \n AND Cast(d_date AS DATE) BETWEEN cast('2002-08-22' AS date) AND ( \n Cast('2002-09-05' AS DATE)) \n AND page_sk = cp_catalog_page_sk \n GROUP BY cp_catalog_page_id) , wsr AS \n( \n SELECT web_site_id, \n sum(sales_price) AS sales, \n sum(profit) AS profit, \n sum(return_amt) AS returns1, \n sum(net_loss) AS profit_loss \n FROM ( \n SELECT ws_web_site_sk AS wsr_web_site_sk, \n ws_sold_date_sk AS date_sk, \n ws_ext_sales_price AS sales_price, \n ws_net_profit AS profit, \n 0 AS return_amt, \n 0 AS net_loss \n FROM web_sales \n UNION ALL \n SELECT ws_web_site_sk AS wsr_web_site_sk, \n wr_returned_date_sk AS date_sk, \n 0 AS sales_price, \n 0 AS profit, \n wr_return_amt AS return_amt, \n wr_net_loss AS net_loss \n FROM web_returns \n LEFT OUTER JOIN web_sales \n ON ( \n wr_item_sk = ws_item_sk \n AND wr_order_number = ws_order_number) ) salesreturns,\n date_dim, \n web_site \n WHERE date_sk = d_date_sk \n AND Cast(d_date AS DATE) BETWEEN cast('2002-08-22' AS date) AND ( \n Cast('2002-09-05' AS DATE)) \n AND wsr_web_site_sk = web_site_sk \n GROUP BY web_site_id) \nSELECT \n channel , \n id , \n sum(sales) AS sales , \n sum(returns1) AS returns1 , \n sum(profit) AS profit \nFROM ( \n SELECT 'store channel' AS channel , \n Concat('store', s_store_id) AS id , \n sales , \n returns1 , \n (profit - profit_loss) AS profit \n FROM ssr \n UNION ALL \n SELECT 'catalog channel' AS channel , \n Concat('catalog_page', cp_catalog_page_id) AS id , \n sales , \n returns1 , \n (profit - profit_loss) AS profit \n FROM csr \n UNION ALL \n SELECT 'web channel' AS channel , \n Concat('web_site', web_site_id) AS id , \n sales , \n returns1 , \n (profit - profit_loss) AS profit \n FROM wsr ) x \nGROUP BY channel, id\nORDER BY channel , \n id \nLIMIT 100; \n\n"},"jobType":"QUERY"},"id":"tpc-ds-2019:US.query5_1570971363","user_email":"nithish.sankaranarayanan@ulb.be"}
