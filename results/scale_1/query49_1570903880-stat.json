{"status":{"state":"DONE"},"kind":"bigquery#job","statistics":{"totalSlotMs":"11091","creationTime":"1570903883473","totalBytesProcessed":"255189288","startTime":"1570903883819","query":{"totalSlotMs":"11091","queryPlan":[{"readMsMax":"12","computeMsMax":"10","waitMsAvg":"1","id":"0","endMs":"1570903884402","waitMsMax":"1","startMs":"1570903884191","waitRatioMax":0.001075268817204301,"readRatioAvg":0.012903225806451613,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.010752688172043012,"writeMsAvg":"6","status":"COMPLETE","writeMsMax":"6","computeMsAvg":"10","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0064516129032258064,"readMsAvg":"12","waitRatioAvg":0.001075268817204301,"completedParallelInputs":"1","computeRatioMax":0.010752688172043012,"name":"S00: Input","shuffleOutputBytes":"279","recordsWritten":"31","readRatioMax":0.012903225806451613,"steps":[{"kind":"READ","substeps":["$20:d_date_sk, $21:d_year, $22:d_moy","FROM date_dim","WHERE and(equal($21, 1999), equal($22, 12))"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output","BY HASH($20)"]}],"writeRatioAvg":0.0064516129032258064},{"readMsMax":"23","computeMsMax":"31","waitMsAvg":"23","id":"1","endMs":"1570903884449","waitMsMax":"23","startMs":"1570903884233","waitRatioMax":0.024731182795698924,"readRatioAvg":0.024731182795698924,"parallelInputs":"1","recordsRead":"288116","computeRatioAvg":0.03333333333333333,"writeMsAvg":"169","status":"COMPLETE","writeMsMax":"169","computeMsAvg":"31","shuffleOutputBytesSpilled":"0","writeRatioMax":0.1817204301075269,"readMsAvg":"23","waitRatioAvg":0.024731182795698924,"completedParallelInputs":"1","computeRatioMax":0.03333333333333333,"name":"S01: Input","shuffleOutputBytes":"16436","recordsWritten":"459","readRatioMax":0.024731182795698924,"steps":[{"kind":"READ","substeps":["$80:sr_item_sk, $81:sr_ticket_number, $82:sr_return_quantity, $83:sr_return_amt","FROM store_returns","WHERE greater($83, 10000)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83","TO __stage01_output","BY HASH($81, $80)"]}],"writeRatioAvg":0.1817204301075269},{"readMsMax":"7","computeMsMax":"8","waitMsAvg":"1","id":"3","endMs":"1570903884408","waitMsMax":"1","startMs":"1570903884324","waitRatioMax":0.001075268817204301,"readRatioAvg":0.007526881720430108,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.008602150537634409,"writeMsAvg":"16","status":"COMPLETE","writeMsMax":"16","computeMsAvg":"8","shuffleOutputBytesSpilled":"0","writeRatioMax":0.017204301075268817,"readMsAvg":"7","waitRatioAvg":0.001075268817204301,"completedParallelInputs":"1","computeRatioMax":0.008602150537634409,"name":"S03: Input","shuffleOutputBytes":"279","recordsWritten":"31","readRatioMax":0.007526881720430108,"steps":[{"kind":"READ","substeps":["$10:d_date_sk, $11:d_year, $12:d_moy","FROM date_dim","WHERE and(equal($11, 1999), equal($12, 12))"]},{"kind":"WRITE","substeps":["$10","TO __stage03_output","BY HASH($10)"]}],"writeRatioAvg":0.017204301075268817},{"readMsMax":"60","computeMsMax":"18","waitMsAvg":"28","id":"4","endMs":"1570903884449","waitMsMax":"28","startMs":"1570903884367","waitRatioMax":0.030107526881720432,"readRatioAvg":0.06451612903225806,"parallelInputs":"1","recordsRead":"143868","computeRatioAvg":0.01935483870967742,"writeMsAvg":"4","status":"COMPLETE","writeMsMax":"4","computeMsAvg":"18","shuffleOutputBytesSpilled":"0","writeRatioMax":0.004301075268817204,"readMsAvg":"60","waitRatioAvg":0.030107526881720432,"completedParallelInputs":"1","computeRatioMax":0.01935483870967742,"name":"S04: Input","shuffleOutputBytes":"43096","recordsWritten":"1200","readRatioMax":0.06451612903225806,"steps":[{"kind":"READ","substeps":["$60:cr_item_sk, $61:cr_order_number, $62:cr_return_quantity, $63:cr_return_amount","FROM catalog_returns","WHERE greater($63, 10000)"]},{"kind":"WRITE","substeps":["$60, $61, $62, $63","TO __stage04_output","BY HASH($61, $60)"]}],"writeRatioAvg":0.004301075268817204},{"readMsMax":"7","computeMsMax":"8","waitMsAvg":"32","id":"6","endMs":"1570903884624","waitMsMax":"32","startMs":"1570903884410","waitRatioMax":0.034408602150537634,"readRatioAvg":0.007526881720430108,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.008602150537634409,"writeMsAvg":"17","status":"COMPLETE","writeMsMax":"17","computeMsAvg":"8","shuffleOutputBytesSpilled":"0","writeRatioMax":0.01827956989247312,"readMsAvg":"7","waitRatioAvg":0.034408602150537634,"completedParallelInputs":"1","computeRatioMax":0.008602150537634409,"name":"S06: Input","shuffleOutputBytes":"279","recordsWritten":"31","readRatioMax":0.007526881720430108,"steps":[{"kind":"READ","substeps":["$1:d_date_sk, $2:d_year, $3:d_moy","FROM date_dim","WHERE and(equal($2, 1999), equal($3, 12))"]},{"kind":"WRITE","substeps":["$1","TO __stage06_output","BY HASH($1)"]}],"writeRatioAvg":0.01827956989247312},{"readMsMax":"23","computeMsMax":"22","waitMsAvg":"16","id":"7","endMs":"1570903884611","waitMsMax":"16","startMs":"1570903884411","waitRatioMax":0.017204301075268817,"readRatioAvg":0.024731182795698924,"parallelInputs":"1","recordsRead":"72121","computeRatioAvg":0.023655913978494623,"writeMsAvg":"6","status":"COMPLETE","writeMsMax":"6","computeMsAvg":"22","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0064516129032258064,"readMsAvg":"23","waitRatioAvg":0.017204301075268817,"completedParallelInputs":"1","computeRatioMax":0.023655913978494623,"name":"S07: Input","shuffleOutputBytes":"21200","recordsWritten":"592","readRatioMax":0.024731182795698924,"steps":[{"kind":"READ","substeps":["$40:wr_item_sk, $41:wr_order_number, $42:wr_return_quantity, $43:wr_return_amt","FROM web_returns","WHERE greater($43, 10000)"]},{"kind":"WRITE","substeps":["$40, $41, $42, $43","TO __stage07_output","BY HASH($41, $40)"]}],"writeRatioAvg":0.0064516129032258064},{"readMsMax":"45","computeMsMax":"693","inputStages":["3","4"],"waitMsAvg":"1","id":"9","endMs":"1570903895505","waitMsMax":"1","startMs":"1570903895093","waitRatioMax":0.001075268817204301,"readRatioAvg":0.04838709677419355,"parallelInputs":"1","recordsRead":"1438673","computeRatioAvg":0.7451612903225806,"writeMsAvg":"4","status":"COMPLETE","writeMsMax":"4","computeMsAvg":"693","shuffleOutputBytesSpilled":"0","writeRatioMax":0.004301075268817204,"readMsAvg":"45","waitRatioAvg":0.001075268817204301,"completedParallelInputs":"1","computeRatioMax":0.7451612903225806,"name":"S09: Join+","shuffleOutputBytes":"1800","recordsWritten":"40","readRatioMax":0.04838709677419355,"steps":[{"kind":"READ","substeps":["$50:cs_sold_date_sk, $51:cs_item_sk, $52:cs_order_number, $53:cs_quantity, $54:cs_net_paid, $55:cs_net_profit","FROM catalog_sales","WHERE and(greater($55, 1), greater($54, 0), greater($53, 0))"]},{"kind":"READ","substeps":["$60, $61, $62, $63","FROM __stage04_output"]},{"kind":"READ","substeps":["$10","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $460 := $450","$260 := SUM($290)","$261 := SUM($291)","$262 := SUM($292)","$263 := SUM($293)"]},{"kind":"COMPUTE","substeps":["$290 := coalesce($453, 0)","$291 := coalesce($451, 0)","$292 := coalesce($454, 0)","$293 := coalesce($452, 0)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $430 = $10"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $52 = $61, $51 = $60"]},{"kind":"WRITE","substeps":["$460, $260, $261, $262, $263","TO __stage09_output","BY HASH($460)"]}],"writeRatioAvg":0.004301075268817204},{"readMsMax":"53","computeMsMax":"930","inputStages":["0","1"],"waitMsAvg":"1","id":"10","endMs":"1570903895963","waitMsMax":"1","startMs":"1570903895112","waitRatioMax":0.001075268817204301,"readRatioAvg":0.05698924731182796,"parallelInputs":"1","recordsRead":"2881668","computeRatioAvg":1,"writeMsAvg":"4","status":"COMPLETE","writeMsMax":"4","computeMsAvg":"930","shuffleOutputBytesSpilled":"0","writeRatioMax":0.004301075268817204,"readMsAvg":"53","waitRatioAvg":0.001075268817204301,"completedParallelInputs":"1","computeRatioMax":1,"name":"S0A: Join+","shuffleOutputBytes":"900","recordsWritten":"20","readRatioMax":0.05698924731182796,"steps":[{"kind":"READ","substeps":["$70:ss_sold_date_sk, $71:ss_item_sk, $72:ss_ticket_number, $73:ss_quantity, $74:ss_net_paid, $75:ss_net_profit","FROM store_sales","WHERE and(greater($75, 1), greater($74, 0), greater($73, 0))"]},{"kind":"READ","substeps":["$80, $81, $82, $83","FROM __stage01_output"]},{"kind":"READ","substeps":["$20","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $570 := $560","$270 := SUM($300)","$271 := SUM($301)","$272 := SUM($302)","$273 := SUM($303)"]},{"kind":"COMPUTE","substeps":["$300 := coalesce($563, 0)","$301 := coalesce($561, 0)","$302 := coalesce($564, 0)","$303 := coalesce($562, 0)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $540 = $20"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $72 = $81, $71 = $80"]},{"kind":"WRITE","substeps":["$570, $270, $271, $272, $273","TO __stage0A_output","BY HASH($570)"]}],"writeRatioAvg":0.004301075268817204},{"readMsMax":"47","computeMsMax":"285","inputStages":["6","7"],"waitMsAvg":"1","id":"12","endMs":"1570903895377","waitMsMax":"1","startMs":"1570903895148","waitRatioMax":0.001075268817204301,"readRatioAvg":0.05053763440860215,"parallelInputs":"1","recordsRead":"721382","computeRatioAvg":0.3064516129032258,"writeMsAvg":"4","status":"COMPLETE","writeMsMax":"4","computeMsAvg":"285","shuffleOutputBytesSpilled":"0","writeRatioMax":0.004301075268817204,"readMsAvg":"47","waitRatioAvg":0.001075268817204301,"completedParallelInputs":"1","computeRatioMax":0.3064516129032258,"name":"S0C: Join+","shuffleOutputBytes":"810","recordsWritten":"18","readRatioMax":0.05053763440860215,"steps":[{"kind":"READ","substeps":["$30:ws_sold_date_sk, $31:ws_item_sk, $32:ws_order_number, $33:ws_quantity, $34:ws_net_paid, $35:ws_net_profit","FROM web_sales","WHERE and(greater($35, 1), greater($34, 0), greater($33, 0))"]},{"kind":"READ","substeps":["$40, $41, $42, $43","FROM __stage07_output"]},{"kind":"READ","substeps":["$1","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $350 := $340","$250 := SUM($280)","$251 := SUM($281)","$252 := SUM($282)","$253 := SUM($283)"]},{"kind":"COMPUTE","substeps":["$280 := coalesce($343, 0)","$281 := coalesce($341, 0)","$282 := coalesce($344, 0)","$283 := coalesce($342, 0)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $320 = $1"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $32 = $41, $31 = $40"]},{"kind":"WRITE","substeps":["$350, $250, $251, $252, $253","TO __stage0C_output","BY HASH($350)"]}],"writeRatioAvg":0.004301075268817204},{"readMsMax":"0","computeMsMax":"7","inputStages":["12"],"waitMsAvg":"2","id":"13","endMs":"1570903895478","waitMsMax":"2","startMs":"1570903895396","waitRatioMax":0.002150537634408602,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"18","computeRatioAvg":0.007526881720430108,"writeMsAvg":"21","status":"COMPLETE","writeMsMax":"21","computeMsAvg":"7","shuffleOutputBytesSpilled":"0","writeRatioMax":0.02258064516129032,"readMsAvg":"0","waitRatioAvg":0.002150537634408602,"completedParallelInputs":"1","computeRatioMax":0.007526881720430108,"name":"S0D: Aggregate+","shuffleOutputBytes":"486","recordsWritten":"18","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$350, $250, $251, $252, $253","FROM __stage0C_output"]},{"kind":"COMPUTE","substeps":["$190 := divide(CAST($220 AS DOUBLE), CAST($221 AS DOUBLE))","$191 := divide($222, $223)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $360 := $350","$220 := SUM($250)","$221 := SUM($251)","$222 := SUM($252)","$223 := SUM($253)"]},{"kind":"WRITE","substeps":["$360, $190, $191","TO __stage0D_output"]}],"writeRatioAvg":0.02258064516129032},{"readMsMax":"0","computeMsMax":"7","inputStages":["9"],"waitMsAvg":"1","id":"14","endMs":"1570903896651","waitMsMax":"1","startMs":"1570903895638","waitRatioMax":0.001075268817204301,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"40","computeRatioAvg":0.007526881720430108,"writeMsAvg":"649","status":"COMPLETE","writeMsMax":"649","computeMsAvg":"7","shuffleOutputBytesSpilled":"0","writeRatioMax":0.6978494623655914,"readMsAvg":"0","waitRatioAvg":0.001075268817204301,"completedParallelInputs":"1","computeRatioMax":0.007526881720430108,"name":"S0E: Aggregate+","shuffleOutputBytes":"1080","recordsWritten":"40","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$460, $260, $261, $262, $263","FROM __stage09_output"]},{"kind":"COMPUTE","substeps":["$200 := divide(CAST($230 AS DOUBLE), CAST($231 AS DOUBLE))","$201 := divide($232, $233)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $470 := $460","$230 := SUM($260)","$231 := SUM($261)","$232 := SUM($262)","$233 := SUM($263)"]},{"kind":"WRITE","substeps":["$470, $200, $201","TO __stage0E_output"]}],"writeRatioAvg":0.6978494623655914},{"readMsMax":"0","computeMsMax":"4","inputStages":["10"],"waitMsAvg":"1","id":"15","endMs":"1570903896180","waitMsMax":"1","startMs":"1570903895967","waitRatioMax":0.001075268817204301,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"20","computeRatioAvg":0.004301075268817204,"writeMsAvg":"6","status":"COMPLETE","writeMsMax":"6","computeMsAvg":"4","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0064516129032258064,"readMsAvg":"0","waitRatioAvg":0.001075268817204301,"completedParallelInputs":"1","computeRatioMax":0.004301075268817204,"name":"S0F: Aggregate+","shuffleOutputBytes":"540","recordsWritten":"20","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$570, $270, $271, $272, $273","FROM __stage0A_output"]},{"kind":"COMPUTE","substeps":["$210 := divide(CAST($240 AS DOUBLE), CAST($241 AS DOUBLE))","$211 := divide($242, $243)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $580 := $570","$240 := SUM($270)","$241 := SUM($271)","$242 := SUM($272)","$243 := SUM($273)"]},{"kind":"WRITE","substeps":["$580, $210, $211","TO __stage0F_output"]}],"writeRatioAvg":0.0064516129032258064},{"readMsMax":"0","computeMsMax":"6","inputStages":["13","14","15"],"waitMsAvg":"2","id":"16","endMs":"1570903896828","waitMsMax":"2","startMs":"1570903895969","waitRatioMax":0.002150537634408602,"readRatioAvg":0,"parallelInputs":"3","recordsRead":"78","computeRatioAvg":0.005376344086021506,"writeMsAvg":"12","status":"COMPLETE","writeMsMax":"27","computeMsAvg":"5","shuffleOutputBytesSpilled":"0","writeRatioMax":0.02903225806451613,"readMsAvg":"0","waitRatioAvg":0.002150537634408602,"completedParallelInputs":"3","computeRatioMax":0.0064516129032258064,"name":"S10: Sort+","shuffleOutputBytes":"1424","recordsWritten":"31","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$360, $190, $191","FROM __stage0D_output"]},{"kind":"READ","substeps":["$470, $200, $201","FROM __stage0E_output"]},{"kind":"READ","substeps":["$580, $210, $211","FROM __stage0F_output"]},{"kind":"SORT","substeps":["$100 ASC, $401 ASC, $130 ASC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$100 := 'web'"]},{"kind":"FILTER","substeps":["or(less_or_equal($401, 10), less_or_equal($130, 10))"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$130 := RANK() OVER (ORDER BY $393 ASC)"]},{"kind":"SORT","substeps":["$382 ASC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$160 := RANK() OVER (ORDER BY $371 ASC)"]},{"kind":"SORT","substeps":["$190 ASC"]},{"kind":"SORT","substeps":["$110 ASC, $511 ASC, $140 ASC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$110 := 'catalog'"]},{"kind":"FILTER","substeps":["or(less_or_equal($511, 10), less_or_equal($140, 10))"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$140 := RANK() OVER (ORDER BY $503 ASC)"]},{"kind":"SORT","substeps":["$492 ASC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := RANK() OVER (ORDER BY $481 ASC)"]},{"kind":"SORT","substeps":["$200 ASC"]},{"kind":"SORT","substeps":["$120 ASC, $621 ASC, $150 ASC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$120 := 'store'"]},{"kind":"FILTER","substeps":["or(less_or_equal($621, 10), less_or_equal($150, 10))"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$150 := RANK() OVER (ORDER BY $613 ASC)"]},{"kind":"SORT","substeps":["$602 ASC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := RANK() OVER (ORDER BY $591 ASC)"]},{"kind":"SORT","substeps":["$210 ASC"]},{"kind":"WRITE","substeps":["$90, $91, $92, $93, $94","TO __stage10_output"]}],"writeRatioAvg":0.012903225806451613},{"readMsMax":"0","computeMsMax":"4","inputStages":["16"],"waitMsAvg":"1","id":"17","endMs":"1570903896917","waitMsMax":"1","startMs":"1570903895989","waitRatioMax":0.001075268817204301,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"31","computeRatioAvg":0.004301075268817204,"writeMsAvg":"6","status":"COMPLETE","writeMsMax":"6","computeMsAvg":"4","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0064516129032258064,"readMsAvg":"0","waitRatioAvg":0.001075268817204301,"completedParallelInputs":"1","computeRatioMax":0.004301075268817204,"name":"S11: Output","shuffleOutputBytes":"1424","recordsWritten":"31","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$90, $91, $92, $93, $94","FROM __stage10_output"]},{"kind":"SORT","substeps":["$90 ASC, $93 ASC, $94 ASC","LIMIT 100"]},{"kind":"WRITE","substeps":["$640, $641, $642, $643, $644","TO __stage11_output"]}],"writeRatioAvg":0.0064516129032258064}],"estimatedBytesProcessed":"255189288","timeline":[{"totalSlotMs":"1108","activeUnits":"2","completedUnits":"6","elapsedMs":"874","pendingUnits":"3"},{"totalSlotMs":"4401","activeUnits":"0","completedUnits":"8","elapsedMs":"1925","pendingUnits":"1"},{"totalSlotMs":"7152","activeUnits":"5","completedUnits":"11","elapsedMs":"12324","pendingUnits":"5"},{"totalSlotMs":"11091","activeUnits":"2","completedUnits":"16","elapsedMs":"13756","pendingUnits":"0"}],"statementType":"SELECT","totalBytesBilled":"255852544","totalPartitionsProcessed":"0","totalBytesProcessed":"255189288","cacheHit":false,"billingTier":1,"referencedTables":[{"projectId":"tpc-ds-2019","tableId":"store_returns","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"date_dim","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"web_returns","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"catalog_returns","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"store_sales","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"catalog_sales","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"web_sales","datasetId":"scale_1"}]},"endTime":"1570903897624"},"jobReference":{"projectId":"tpc-ds-2019","location":"US","jobId":"query49_1570903880"},"etag":"Hhr42l6SqAcJM6QXTjfQ3Q==","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tpc-ds-2019/jobs/query49_1570903880?location=US","configuration":{"query":{"maximumBillingTier":10,"defaultDataset":{"projectId":"tpc-ds-2019","datasetId":"scale_1"},"useLegacySql":false,"destinationTable":{"projectId":"tpc-ds-2019","tableId":"anon8d9ebd1733a5b7168e6c9be82ee3c1097cbbf068","datasetId":"_0ca6f7c7da88564ba26827da43395a8255e28ecd"},"priority":"INTERACTIVE","writeDisposition":"WRITE_TRUNCATE","createDisposition":"CREATE_IF_NEEDED","query":"-- query49\nSELECT 'web' AS channel, \n web.item, \n web.return_ratio, \n web.return_rank, \n web.currency_rank \nFROM (SELECT item, \n return_ratio, \n currency_ratio, \n Rank() \n OVER ( \n ORDER BY return_ratio) AS return_rank, \n Rank() \n OVER ( \n ORDER BY currency_ratio) AS currency_rank \n FROM (SELECT ws.ws_item_sk AS item, \n ( Sum(COALESCE(wr.wr_return_quantity, 0)) / \n Sum(COALESCE(ws.ws_quantity, 0)) ) AS \n return_ratio, \n ( Sum(COALESCE(wr.wr_return_amt, 0)) / \n Sum(COALESCE(ws.ws_net_paid, 0)) ) AS currency_ratio \n FROM web_sales ws \n LEFT OUTER JOIN web_returns wr \n ON ( ws.ws_order_number = wr.wr_order_number \n AND ws.ws_item_sk = wr.wr_item_sk ), \n date_dim \n WHERE wr.wr_return_amt > 10000 \n AND ws.ws_net_profit > 1 \n AND ws.ws_net_paid > 0 \n AND ws.ws_quantity > 0 \n AND ws_sold_date_sk = d_date_sk \n AND d_year = 1999 \n AND d_moy = 12 \n GROUP BY ws.ws_item_sk) in_web) web \nWHERE ( web.return_rank <= 10 \n OR web.currency_rank <= 10 ) \nUNION ALL \nSELECT 'catalog' AS channel, \n catalog.item, \n catalog.return_ratio, \n catalog.return_rank, \n catalog.currency_rank \nFROM (SELECT item, \n return_ratio, \n currency_ratio, \n Rank() \n OVER ( \n ORDER BY return_ratio) AS return_rank, \n Rank() \n OVER ( \n ORDER BY currency_ratio) AS currency_rank \n FROM (SELECT cs.cs_item_sk AS \n item, \n ( Sum(COALESCE(cr.cr_return_quantity, 0)) / \n Sum(COALESCE(cs.cs_quantity, 0)) ) AS \n return_ratio, \n ( Sum(COALESCE(cr.cr_return_amount, 0)) / \n Sum(COALESCE(cs.cs_net_paid, 0)) ) AS \n currency_ratio \n FROM catalog_sales cs \n LEFT OUTER JOIN catalog_returns cr \n ON ( cs.cs_order_number = cr.cr_order_number \n AND cs.cs_item_sk = cr.cr_item_sk ), \n date_dim \n WHERE cr.cr_return_amount > 10000 \n AND cs.cs_net_profit > 1 \n AND cs.cs_net_paid > 0 \n AND cs.cs_quantity > 0 \n AND cs_sold_date_sk = d_date_sk \n AND d_year = 1999 \n AND d_moy = 12 \n GROUP BY cs.cs_item_sk) in_cat) catalog \nWHERE ( catalog.return_rank <= 10 \n OR catalog.currency_rank <= 10 ) \nUNION ALL\nSELECT 'store' AS channel, \n store.item, \n store.return_ratio, \n store.return_rank, \n store.currency_rank \nFROM (SELECT item, \n return_ratio, \n currency_ratio, \n Rank() \n OVER ( \n ORDER BY return_ratio) AS return_rank, \n Rank() \n OVER ( \n ORDER BY currency_ratio) AS currency_rank \n FROM (SELECT sts.ss_item_sk AS \n item, \n ( Sum(COALESCE(sr.sr_return_quantity, 0)) / \n Sum(COALESCE(sts.ss_quantity, 0)) ) AS \n return_ratio, \n ( Sum(COALESCE(sr.sr_return_amt, 0)) \n / Sum(COALESCE(sts.ss_net_paid, 0)) ) AS \n currency_ratio \n FROM store_sales sts \n LEFT OUTER JOIN store_returns sr \n ON ( sts.ss_ticket_number = \n sr.sr_ticket_number \n AND sts.ss_item_sk = sr.sr_item_sk ), \n date_dim \n WHERE sr.sr_return_amt > 10000 \n AND sts.ss_net_profit > 1 \n AND sts.ss_net_paid > 0 \n AND sts.ss_quantity > 0 \n AND ss_sold_date_sk = d_date_sk \n AND d_year = 1999 \n AND d_moy = 12 \n GROUP BY sts.ss_item_sk) in_store) store \nWHERE ( store.return_rank <= 10 \n OR store.currency_rank <= 10 ) \nORDER BY 1, \n 4, \n 5\nLIMIT 100; \n"},"jobType":"QUERY"},"id":"tpc-ds-2019:US.query49_1570903880","user_email":"nithish.sankaranarayanan@ulb.be"}
