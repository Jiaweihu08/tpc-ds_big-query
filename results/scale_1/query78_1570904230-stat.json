{"status":{"state":"DONE"},"kind":"bigquery#job","statistics":{"totalSlotMs":"64706","creationTime":"1570904232601","totalBytesProcessed":"285961280","startTime":"1570904232788","query":{"totalSlotMs":"64706","queryPlan":[{"readMsMax":"18","computeMsMax":"52","waitMsAvg":"1","id":"0","endMs":"1570904233022","waitMsMax":"1","startMs":"1570904232962","waitRatioMax":0.00011980352222355337,"readRatioAvg":0.0021564634000239605,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.006229783155624775,"writeMsAvg":"10","status":"COMPLETE","writeMsMax":"10","computeMsAvg":"52","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0011980352222355337,"readMsAvg":"18","waitRatioAvg":0.00011980352222355337,"completedParallelInputs":"1","computeRatioMax":0.006229783155624775,"name":"S00: Input","shuffleOutputBytes":"1314882","recordsWritten":"73049","readRatioMax":0.0021564634000239605,"steps":[{"kind":"READ","substeps":["$10:d_date_sk, $11:d_year","FROM date_dim"]},{"kind":"WRITE","substeps":["$10, $11","TO __stage00_output","BY HASH($10)"]}],"writeRatioAvg":0.0011980352222355337},{"readMsMax":"16","computeMsMax":"72","waitMsAvg":"31","id":"1","endMs":"1570904233201","waitMsMax":"31","startMs":"1570904233005","waitRatioMax":0.0037139091889301546,"readRatioAvg":0.001916856355576854,"parallelInputs":"1","recordsRead":"72121","computeRatioAvg":0.008625853600095842,"writeMsAvg":"136","status":"COMPLETE","writeMsMax":"136","computeMsAvg":"72","shuffleOutputBytesSpilled":"0","writeRatioMax":0.016293279022403257,"readMsAvg":"16","waitRatioAvg":0.0037139091889301546,"completedParallelInputs":"1","computeRatioMax":0.008625853600095842,"name":"S01: Input","shuffleOutputBytes":"1298178","recordsWritten":"72121","readRatioMax":0.001916856355576854,"steps":[{"kind":"READ","substeps":["$80:wr_item_sk, $81:wr_order_number","FROM web_returns"]},{"kind":"WRITE","substeps":["$80, $81","TO __stage01_output","BY HASH($81, $80)"]}],"writeRatioAvg":0.016293279022403257},{"readMsMax":"9","computeMsMax":"7","waitMsAvg":"35","id":"2","endMs":"1570904233224","waitMsMax":"35","startMs":"1570904233023","waitRatioMax":0.004193123277824368,"readRatioAvg":0.0010782317000119803,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.0008386246555648736,"writeMsAvg":"183","status":"COMPLETE","writeMsMax":"183","computeMsAvg":"7","shuffleOutputBytesSpilled":"0","writeRatioMax":0.021924044566910265,"readMsAvg":"9","waitRatioAvg":0.004193123277824368,"completedParallelInputs":"1","computeRatioMax":0.0008386246555648736,"name":"S02: Input","shuffleOutputBytes":"6570","recordsWritten":"365","readRatioMax":0.0010782317000119803,"steps":[{"kind":"READ","substeps":["$30:d_date_sk, $31:d_year","FROM date_dim","WHERE equal($31, 1999)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage02_output","BY HASH($30)"]}],"writeRatioAvg":0.021924044566910265},{"readMsMax":"21","computeMsMax":"291","waitMsAvg":"44","id":"3","endMs":"1570904233440","waitMsMax":"44","startMs":"1570904233048","waitRatioMax":0.005271354977836348,"readRatioAvg":0.0025158739666946207,"parallelInputs":"1","recordsRead":"288116","computeRatioAvg":0.034862824967054035,"writeMsAvg":"32","status":"COMPLETE","writeMsMax":"32","computeMsAvg":"291","shuffleOutputBytesSpilled":"0","writeRatioMax":0.003833712711153708,"readMsAvg":"21","waitRatioAvg":0.005271354977836348,"completedParallelInputs":"1","computeRatioMax":0.034862824967054035,"name":"S03: Input","shuffleOutputBytes":"5186088","recordsWritten":"288116","readRatioMax":0.0025158739666946207,"steps":[{"kind":"READ","substeps":["$60:sr_item_sk, $61:sr_ticket_number","FROM store_returns"]},{"kind":"WRITE","substeps":["$60, $61","TO __stage03_output","BY HASH($61, $60)"]}],"writeRatioAvg":0.003833712711153708},{"readMsMax":"9","computeMsMax":"44","waitMsAvg":"1","id":"4","endMs":"1570904233153","waitMsMax":"1","startMs":"1570904233091","waitRatioMax":0.00011980352222355337,"readRatioAvg":0.0010782317000119803,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.005271354977836348,"writeMsAvg":"11","status":"COMPLETE","writeMsMax":"11","computeMsAvg":"44","shuffleOutputBytesSpilled":"0","writeRatioMax":0.001317838744459087,"readMsAvg":"9","waitRatioAvg":0.00011980352222355337,"completedParallelInputs":"1","computeRatioMax":0.005271354977836348,"name":"S04: Input","shuffleOutputBytes":"1314882","recordsWritten":"73049","readRatioMax":0.0010782317000119803,"steps":[{"kind":"READ","substeps":["$1:d_date_sk, $2:d_year","FROM date_dim"]},{"kind":"WRITE","substeps":["$1, $2","TO __stage04_output","BY HASH($1)"]}],"writeRatioAvg":0.001317838744459087},{"readMsMax":"15","computeMsMax":"152","waitMsAvg":"1","id":"5","endMs":"1570904233842","waitMsMax":"1","startMs":"1570904233106","waitRatioMax":0.00011980352222355337,"readRatioAvg":0.0017970528333533006,"parallelInputs":"1","recordsRead":"143868","computeRatioAvg":0.01821013537798011,"writeMsAvg":"13","status":"COMPLETE","writeMsMax":"13","computeMsAvg":"152","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0015574457889061938,"readMsAvg":"15","waitRatioAvg":0.00011980352222355337,"completedParallelInputs":"1","computeRatioMax":0.01821013537798011,"name":"S05: Input","shuffleOutputBytes":"2589624","recordsWritten":"143868","readRatioMax":0.0017970528333533006,"steps":[{"kind":"READ","substeps":["$20:cr_item_sk, $21:cr_order_number","FROM catalog_returns"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage05_output","BY HASH($21, $20)"]}],"writeRatioAvg":0.0015574457889061938},{"readMsMax":"59","computeMsMax":"2601","inputStages":["0","1"],"waitMsAvg":"1","id":"6","endMs":"1570904234790","waitMsMax":"1","startMs":"1570904233248","waitRatioMax":0.00011980352222355337,"readRatioAvg":0.007068407811189649,"parallelInputs":"1","recordsRead":"865929","computeRatioAvg":0.31160896130346233,"writeMsAvg":"49","status":"COMPLETE","writeMsMax":"49","computeMsAvg":"2601","shuffleOutputBytesSpilled":"0","writeRatioMax":0.005870372588954115,"readMsAvg":"59","waitRatioAvg":0.00011980352222355337,"completedParallelInputs":"1","computeRatioMax":0.31160896130346233,"name":"S06: Join+","shuffleOutputBytes":"35014244","recordsWritten":"648458","readRatioMax":0.007068407811189649,"steps":[{"kind":"READ","substeps":["$70:ws_sold_date_sk, $71:ws_item_sk, $72:ws_bill_customer_sk, $73:ws_order_number, $74:ws_quantity, $75:ws_wholesale_cost, $76:ws_sales_price","FROM web_sales"]},{"kind":"READ","substeps":["$80, $81","FROM __stage01_output"]},{"kind":"READ","substeps":["$10, $11","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $230 := $225, $231 := $220, $232 := $221","$150 := SUM($222)","$151 := SUM($223)","$152 := SUM($224)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $210 = $10"]},{"kind":"FILTER","substeps":["is_null($216)"]},{"kind":"JOIN","substeps":["LEFT OUTER HASH JOIN EACH WITH ALL ON $73 = $81, $71 = $80"]},{"kind":"WRITE","substeps":["$230, $231, $232, $150, $151, $152","TO __stage06_output","BY HASH($230, $231, $232)"]}],"writeRatioAvg":0.005870372588954115},{"readMsMax":"50","computeMsMax":"7393","inputStages":["2","3"],"waitMsAvg":"3","id":"7","endMs":"1570904237587","waitMsMax":"3","startMs":"1570904233518","waitRatioMax":0.0003594105666706601,"readRatioAvg":0.0059901761111776685,"parallelInputs":"1","recordsRead":"3169659","computeRatioAvg":0.8857074397987301,"writeMsAvg":"52","status":"COMPLETE","writeMsMax":"52","computeMsAvg":"7393","shuffleOutputBytesSpilled":"0","writeRatioMax":0.006229783155624775,"readMsAvg":"50","waitRatioAvg":0.0003594105666706601,"completedParallelInputs":"1","computeRatioMax":0.8857074397987301,"name":"S07: Join+","shuffleOutputBytes":"26267478","recordsWritten":"490997","readRatioMax":0.0059901761111776685,"steps":[{"kind":"READ","substeps":["$50:ss_sold_date_sk, $51:ss_item_sk, $52:ss_customer_sk, $53:ss_ticket_number, $54:ss_quantity, $55:ss_wholesale_cost, $56:ss_sales_price","FROM store_sales"]},{"kind":"READ","substeps":["$60, $61","FROM __stage03_output"]},{"kind":"READ","substeps":["$30, $31","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $190 := $185, $191 := $180, $192 := $181","$140 := SUM($182)","$141 := SUM($183)","$142 := SUM($184)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $160 = $30"]},{"kind":"FILTER","substeps":["is_null($166)"]},{"kind":"JOIN","substeps":["LEFT OUTER HASH JOIN EACH WITH ALL ON $53 = $61, $51 = $60"]},{"kind":"WRITE","substeps":["$190, $191, $192, $140, $141, $142","TO __stage07_output","BY HASH($190, $191, $192)"]}],"writeRatioAvg":0.006229783155624775},{"readMsMax":"88","computeMsMax":"8347","inputStages":["4","5"],"waitMsAvg":"1","id":"8","endMs":"1570904238313","waitMsMax":"1","startMs":"1570904233952","waitRatioMax":0.00011980352222355337,"readRatioAvg":0.010542709955672696,"parallelInputs":"1","recordsRead":"1654359","computeRatioAvg":1,"writeMsAvg":"38","status":"COMPLETE","writeMsMax":"38","computeMsAvg":"8347","shuffleOutputBytesSpilled":"0","writeRatioMax":0.004552533844495028,"readMsAvg":"88","waitRatioAvg":0.00011980352222355337,"completedParallelInputs":"1","computeRatioMax":1,"name":"S08: Join+","shuffleOutputBytes":"69383446","recordsWritten":"1286749","readRatioMax":0.010542709955672696,"steps":[{"kind":"READ","substeps":["$40:cs_sold_date_sk, $41:cs_bill_customer_sk, $42:cs_item_sk, $43:cs_order_number, $44:cs_quantity, $45:cs_wholesale_cost, $46:cs_sales_price","FROM catalog_sales","WHERE equal($42, $42)"]},{"kind":"READ","substeps":["$20, $21","FROM __stage05_output"]},{"kind":"READ","substeps":["$1, $2","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $280 := $275, $281 := $271, $282 := $270","$130 := SUM($272)","$131 := SUM($273)","$132 := SUM($274)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $260 = $1"]},{"kind":"FILTER","substeps":["is_null($266)"]},{"kind":"JOIN","substeps":["LEFT OUTER HASH JOIN EACH WITH ALL ON $43 = $21, $42 = $20"]},{"kind":"WRITE","substeps":["$280, $282, $281, $130, $131, $132","TO __stage08_output","BY HASH($280, $281, $282)"]}],"writeRatioAvg":0.004552533844495028},{"readMsMax":"0","computeMsMax":"4796","inputStages":["8"],"waitMsAvg":"1","id":"9","endMs":"1570904241403","waitMsMax":"1","startMs":"1570904238770","waitRatioMax":0.00011980352222355337,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"1286749","computeRatioAvg":0.574577692584162,"writeMsAvg":"41","status":"COMPLETE","writeMsMax":"41","computeMsAvg":"4796","shuffleOutputBytesSpilled":"0","writeRatioMax":0.004911944411165688,"readMsAvg":"0","waitRatioAvg":0.00011980352222355337,"completedParallelInputs":"1","computeRatioMax":0.574577692584162,"name":"S09: Aggregate","shuffleOutputBytes":"57723389","recordsWritten":"1283593","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$280, $282, $281, $130, $131, $132","FROM __stage08_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $280, $291 := $281, $292 := $282","$100 := SUM($130)","$101 := SUM($131)","$102 := SUM($132)"]},{"kind":"WRITE","substeps":["$100, $101, $102, $290, $292","TO __stage09_output","BY HASH($290, $292)"]}],"writeRatioAvg":0.004911944411165688},{"readMsMax":"0","computeMsMax":"2332","inputStages":["6"],"waitMsAvg":"1","id":"10","endMs":"1570904239959","waitMsMax":"1","startMs":"1570904238783","waitRatioMax":0.00011980352222355337,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"648458","computeRatioAvg":0.27938181382532645,"writeMsAvg":"13","status":"COMPLETE","writeMsMax":"13","computeMsAvg":"2332","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0015574457889061938,"readMsAvg":"0","waitRatioAvg":0.00011980352222355337,"completedParallelInputs":"1","computeRatioMax":0.27938181382532645,"name":"S0A: Aggregate","shuffleOutputBytes":"35011802","recordsWritten":"648383","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$230, $231, $232, $150, $151, $152","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $240 := $230, $241 := $231, $242 := $232","$120 := SUM($150)","$121 := SUM($151)","$122 := SUM($152)"]},{"kind":"WRITE","substeps":["$120, $121, $122, $240, $241, $242","TO __stage0A_output","BY HASH($240, $241, $242)"]}],"writeRatioAvg":0.0015574457889061938},{"readMsMax":"0","computeMsMax":"20","inputStages":["10"],"waitMsAvg":"2","id":"11","endMs":"1570904240303","waitMsMax":"15","startMs":"1570904240178","waitRatioMax":0.0017970528333533006,"readRatioAvg":0,"parallelInputs":"100","recordsRead":"648383","computeRatioAvg":0.0015574457889061938,"writeMsAvg":"19","status":"COMPLETE","writeMsMax":"37","computeMsAvg":"13","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0044327303222714744,"readMsAvg":"0","waitRatioAvg":0.00023960704444710675,"completedParallelInputs":"100","computeRatioMax":0.0023960704444710673,"name":"S0B: Coalesce","shuffleOutputBytes":"35011802","recordsWritten":"648383","readRatioMax":0,"steps":[{"kind":"READ","substeps":["FROM __stage0A_output"]}],"writeRatioAvg":0.002276266922247514},{"readMsMax":"0","computeMsMax":"23","inputStages":["9"],"waitMsAvg":"1","id":"12","endMs":"1570904241863","waitMsMax":"4","startMs":"1570904241589","waitRatioMax":0.0004792140888942135,"readRatioAvg":0,"parallelInputs":"100","recordsRead":"1283593","computeRatioAvg":0.0021564634000239605,"writeMsAvg":"102","status":"COMPLETE","writeMsMax":"194","computeMsAvg":"18","shuffleOutputBytesSpilled":"0","writeRatioMax":0.023241883311369355,"readMsAvg":"0","waitRatioAvg":0.00011980352222355337,"completedParallelInputs":"100","computeRatioMax":0.0027554810111417275,"name":"S0C: Coalesce","shuffleOutputBytes":"57723389","recordsWritten":"1283593","readRatioMax":0,"steps":[{"kind":"READ","substeps":["FROM __stage09_output"]}],"writeRatioAvg":0.012219959266802444},{"readMsMax":"0","computeMsMax":"3448","inputStages":["7","12","11"],"waitMsAvg":"4","id":"13","endMs":"1570904243799","waitMsMax":"4","startMs":"1570904241594","waitRatioMax":0.0004792140888942135,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"2422973","computeRatioAvg":0.41308254462681204,"writeMsAvg":"4","status":"COMPLETE","writeMsMax":"4","computeMsAvg":"3448","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0004792140888942135,"readMsAvg":"0","waitRatioAvg":0.0004792140888942135,"completedParallelInputs":"1","computeRatioMax":0.41308254462681204,"name":"S0D: Join+","shuffleOutputBytes":"7200","recordsWritten":"100","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$190, $191, $192, $140, $141, $142","FROM __stage07_output"]},{"kind":"READ","substeps":["$120, $121, $122, $240, $241, $242","FROM __stage0B_output"]},{"kind":"READ","substeps":["$100, $101, $102, $290, $292","FROM __stage0C_output"]},{"kind":"SORT","substeps":["$300 ASC, $301 DESC, $302 DESC, $303 DESC, $91 ASC, $92 ASC, $93 ASC, $90 ASC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$90 := round(divide(CAST($301 AS DOUBLE), CAST(coalesce(add($304, $307), 1) AS DOUBLE)), 2)","$91 := add(coalesce($304, 0), coalesce($307, 0))","$92 := add(coalesce($305, 0), coalesce($308, 0))","$93 := add(coalesce($306, 0), coalesce($309, 0))"]},{"kind":"FILTER","substeps":["greater(coalesce($307, 0), 0)"]},{"kind":"JOIN","substeps":["LEFT OUTER HASH JOIN EACH WITH ALL ON $250 = $290, $252 = $292"]},{"kind":"FILTER","substeps":["greater(coalesce($256, 0), 0)"]},{"kind":"JOIN","substeps":["LEFT OUTER HASH JOIN EACH WITH ALL ON $200 = $240, $201 = $241, $202 = $242"]},{"kind":"AGGREGATE","substeps":["GROUP BY $200 := $190, $201 := $191, $202 := $192","$110 := SUM($140)","$111 := SUM($141)","$112 := SUM($142)"]},{"kind":"WRITE","substeps":["$310, $311, $312, $313, $314, $315, $316, $317","TO __stage0D_output"]}],"writeRatioAvg":0.0004792140888942135},{"readMsMax":"0","computeMsMax":"5","inputStages":["13"],"waitMsAvg":"1","id":"14","endMs":"1570904244122","waitMsMax":"1","startMs":"1570904241643","waitRatioMax":0.00011980352222355337,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"100","computeRatioAvg":0.0005990176111177668,"writeMsAvg":"6","status":"COMPLETE","writeMsMax":"6","computeMsAvg":"5","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0007188211333413202,"readMsAvg":"0","waitRatioAvg":0.00011980352222355337,"completedParallelInputs":"1","computeRatioMax":0.0005990176111177668,"name":"S0E: Output","shuffleOutputBytes":"7200","recordsWritten":"100","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$310, $311, $312, $313, $314, $315, $316, $317","FROM __stage0D_output"]},{"kind":"SORT","substeps":["$310 ASC, $315 DESC, $316 DESC, $317 DESC, $312 ASC, $313 ASC, $314 ASC, $311 ASC","LIMIT 100"]},{"kind":"WRITE","substeps":["$320, $321, $322, $323, $324, $325, $326, $327","TO __stage0E_output"]}],"writeRatioAvg":0.0007188211333413202}],"estimatedBytesProcessed":"285961280","timeline":[{"totalSlotMs":"998","activeUnits":"2","completedUnits":"5","elapsedMs":"675","pendingUnits":"2"},{"totalSlotMs":"2381","activeUnits":"3","completedUnits":"6","elapsedMs":"1232","pendingUnits":"3"},{"totalSlotMs":"10574","activeUnits":"2","completedUnits":"7","elapsedMs":"2505","pendingUnits":"2"},{"totalSlotMs":"22951","activeUnits":"2","completedUnits":"9","elapsedMs":"6029","pendingUnits":"2"},{"totalSlotMs":"37938","activeUnits":"1","completedUnits":"110","elapsedMs":"7675","pendingUnits":"1"},{"totalSlotMs":"58492","activeUnits":"2","completedUnits":"211","elapsedMs":"9119","pendingUnits":"2"},{"totalSlotMs":"64706","activeUnits":"0","completedUnits":"213","elapsedMs":"12326","pendingUnits":"0"}],"statementType":"SELECT","totalBytesBilled":"286261248","totalPartitionsProcessed":"0","totalBytesProcessed":"285961280","cacheHit":false,"billingTier":1,"referencedTables":[{"projectId":"tpc-ds-2019","tableId":"store_returns","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"date_dim","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"web_returns","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"catalog_returns","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"store_sales","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"catalog_sales","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"web_sales","datasetId":"scale_1"}]},"endTime":"1570904245141"},"jobReference":{"projectId":"tpc-ds-2019","location":"US","jobId":"query78_1570904230"},"etag":"Z88XL/liFZ65NdOwYyYuNg==","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tpc-ds-2019/jobs/query78_1570904230?location=US","configuration":{"query":{"maximumBillingTier":10,"defaultDataset":{"projectId":"tpc-ds-2019","datasetId":"scale_1"},"useLegacySql":false,"destinationTable":{"projectId":"tpc-ds-2019","tableId":"anon7ba2e84041384590767ff3ffcb2c4460652fd376","datasetId":"_0ca6f7c7da88564ba26827da43395a8255e28ecd"},"priority":"INTERACTIVE","writeDisposition":"WRITE_TRUNCATE","createDisposition":"CREATE_IF_NEEDED","query":"-- query78\nWITH ws \n AS (SELECT d_year AS ws_sold_year, \n ws_item_sk, \n ws_bill_customer_sk ws_customer_sk, \n Sum(ws_quantity) ws_qty, \n Sum(ws_wholesale_cost) ws_wc, \n Sum(ws_sales_price) ws_sp \n FROM web_sales \n LEFT JOIN web_returns \n ON wr_order_number = ws_order_number \n AND ws_item_sk = wr_item_sk \n JOIN date_dim \n ON ws_sold_date_sk = d_date_sk \n WHERE wr_order_number IS NULL \n GROUP BY d_year, \n ws_item_sk, \n ws_bill_customer_sk), \n cs \n AS (SELECT d_year AS cs_sold_year, \n cs_item_sk, \n cs_bill_customer_sk cs_customer_sk, \n Sum(cs_quantity) cs_qty, \n Sum(cs_wholesale_cost) cs_wc, \n Sum(cs_sales_price) cs_sp \n FROM catalog_sales \n LEFT JOIN catalog_returns \n ON cr_order_number = cs_order_number \n AND cs_item_sk = cr_item_sk \n JOIN date_dim \n ON cs_sold_date_sk = d_date_sk \n WHERE cr_order_number IS NULL \n GROUP BY d_year, \n cs_item_sk, \n cs_bill_customer_sk), \n ss \n AS (SELECT d_year AS ss_sold_year, \n ss_item_sk, \n ss_customer_sk, \n Sum(ss_quantity) ss_qty, \n Sum(ss_wholesale_cost) ss_wc, \n Sum(ss_sales_price) ss_sp \n FROM store_sales \n LEFT JOIN store_returns \n ON sr_ticket_number = ss_ticket_number \n AND ss_item_sk = sr_item_sk \n JOIN date_dim \n ON ss_sold_date_sk = d_date_sk \n WHERE sr_ticket_number IS NULL \n GROUP BY d_year, \n ss_item_sk, \n ss_customer_sk) \nSELECT ss_item_sk, \n Round(ss_qty / ( COALESCE(ws_qty + cs_qty, 1) ), 2) ratio, \n ss_qty store_qty, \n ss_wc \n store_wholesale_cost, \n ss_sp \n store_sales_price, \n COALESCE(ws_qty, 0) + COALESCE(cs_qty, 0) \n other_chan_qty, \n COALESCE(ws_wc, 0) + COALESCE(cs_wc, 0) \n other_chan_wholesale_cost, \n COALESCE(ws_sp, 0) + COALESCE(cs_sp, 0) \n other_chan_sales_price \nFROM ss \n LEFT JOIN ws \n ON ( ws_sold_year = ss_sold_year \n AND ws_item_sk = ss_item_sk \n AND ws_customer_sk = ss_customer_sk ) \n LEFT JOIN cs \n ON ( cs_sold_year = ss_sold_year \n AND cs_item_sk = cs_item_sk \n AND cs_customer_sk = ss_customer_sk ) \nWHERE COALESCE(ws_qty, 0) > 0 \n AND COALESCE(cs_qty, 0) > 0 \n AND ss_sold_year = 1999 \nORDER BY ss_item_sk, \n ss_qty DESC, \n ss_wc DESC, \n ss_sp DESC, \n other_chan_qty, \n other_chan_wholesale_cost, \n other_chan_sales_price, \n Round(ss_qty / ( COALESCE(ws_qty + cs_qty, 1) ), 2)\nLIMIT 100; \n"},"jobType":"QUERY"},"id":"tpc-ds-2019:US.query78_1570904230","user_email":"nithish.sankaranarayanan@ulb.be"}
