{"status":{"state":"DONE"},"kind":"bigquery#job","statistics":{"totalSlotMs":"8184","creationTime":"1570904108240","totalBytesProcessed":"115174869","startTime":"1570904108347","query":{"totalSlotMs":"8184","queryPlan":[{"readMsMax":"13","computeMsMax":"32","waitMsAvg":"3","id":"0","endMs":"1570904108647","waitMsMax":"3","startMs":"1570904108556","waitRatioMax":0.0007416563658838071,"readRatioAvg":0.0032138442521631645,"parallelInputs":"1","recordsRead":"18000","computeRatioAvg":0.007911001236093944,"writeMsAvg":"8","status":"COMPLETE","writeMsMax":"8","computeMsAvg":"32","shuffleOutputBytesSpilled":"0","writeRatioMax":0.001977750309023486,"readMsAvg":"13","waitRatioAvg":0.0007416563658838071,"completedParallelInputs":"1","computeRatioMax":0.007911001236093944,"name":"S00: Input","shuffleOutputBytes":"1381383","recordsWritten":"18000","readRatioMax":0.0032138442521631645,"steps":[{"kind":"READ","substeps":["$1:i_item_sk, $2:i_brand, $3:i_class, $4:i_category, $5:i_product_name","FROM item"]},{"kind":"WRITE","substeps":["$1, $2, $3, $4, $5","TO __stage00_output","BY HASH($1)"]}],"writeRatioAvg":0.001977750309023486},{"readMsMax":"20","computeMsMax":"5","waitMsAvg":"28","id":"1","endMs":"1570904108679","waitMsMax":"28","startMs":"1570904108598","waitRatioMax":0.0069221260815822,"readRatioAvg":0.004944375772558714,"parallelInputs":"1","recordsRead":"12","computeRatioAvg":0.0012360939431396785,"writeMsAvg":"5","status":"COMPLETE","writeMsMax":"5","computeMsAvg":"5","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0012360939431396785,"readMsAvg":"20","waitRatioAvg":0.0069221260815822,"completedParallelInputs":"1","computeRatioMax":0.0012360939431396785,"name":"S01: Input","shuffleOutputBytes":"360","recordsWritten":"12","readRatioMax":0.004944375772558714,"steps":[{"kind":"READ","substeps":["$10:s_store_sk, $11:s_store_id","FROM store"]},{"kind":"WRITE","substeps":["$10, $11","TO __stage01_output","BY HASH($10)"]}],"writeRatioAvg":0.0012360939431396785},{"readMsMax":"11","computeMsMax":"12","waitMsAvg":"31","id":"2","endMs":"1570904108770","waitMsMax":"31","startMs":"1570904108634","waitRatioMax":0.007663782447466007,"readRatioAvg":0.002719406674907293,"parallelInputs":"1","recordsRead":"73049","computeRatioAvg":0.0029666254635352285,"writeMsAvg":"96","status":"COMPLETE","writeMsMax":"96","computeMsAvg":"12","shuffleOutputBytesSpilled":"0","writeRatioMax":0.023733003708281828,"readMsAvg":"11","waitRatioAvg":0.007663782447466007,"completedParallelInputs":"1","computeRatioMax":0.0029666254635352285,"name":"S02: Input","shuffleOutputBytes":"13140","recordsWritten":"365","readRatioMax":0.002719406674907293,"steps":[{"kind":"READ","substeps":["$30:d_date_sk, $32:d_year, $33:d_moy, $34:d_qoy, $31:d_month_seq","FROM date_dim","WHERE between($31, 1181, 1192)"]},{"kind":"WRITE","substeps":["$30, $32, $33, $34","TO __stage02_output","BY HASH($30)"]}],"writeRatioAvg":0.023733003708281828},{"readMsMax":"40","computeMsMax":"4045","inputStages":["0","1","2"],"waitMsAvg":"1","id":"4","endMs":"1570904110873","waitMsMax":"1","startMs":"1570904108796","waitRatioMax":0.00024721878862793575,"readRatioAvg":0.009888751545117428,"parallelInputs":"1","recordsRead":"2899555","computeRatioAvg":1,"writeMsAvg":"9","status":"COMPLETE","writeMsMax":"9","computeMsAvg":"4045","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0022249690976514215,"readMsAvg":"40","waitRatioAvg":0.00024721878862793575,"completedParallelInputs":"1","computeRatioMax":1,"name":"S04: Join+","shuffleOutputBytes":"42664897","recordsWritten":"342284","readRatioMax":0.009888751545117428,"steps":[{"kind":"READ","substeps":["$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_store_sk, $23:ss_quantity, $24:ss_sales_price","FROM store_sales"]},{"kind":"READ","substeps":["$30, $32, $33, $34","FROM __stage02_output"]},{"kind":"READ","substeps":["$10, $11","FROM __stage01_output"]},{"kind":"READ","substeps":["$1, $2, $3, $4, $5","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $110 := $108, $111 := $107, $112 := $106, $113 := $109, $114 := $103, $115 := $105, $116 := $104, $117 := $100","$60 := SUM($70)"]},{"kind":"COMPUTE","substeps":["$70 := coalesce(multiply($102, CAST($101 AS DOUBLE)), 0)"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $90 = $1"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $81 = $10"]},{"kind":"JOIN","substeps":["INNER HASH JOIN EACH WITH ALL ON $20 = $30"]},{"kind":"WRITE","substeps":["$112, $111, $110, $113, $117, $114, $116, $115, $60","TO __stage04_output","BY HASH($110, $111, $112, $113, $114, $115, $116, $117)"]}],"writeRatioAvg":0.0022249690976514215},{"readMsMax":"0","computeMsMax":"1668","inputStages":["4"],"waitMsAvg":"3","id":"5","endMs":"1570904112276","waitMsMax":"3","startMs":"1570904111367","waitRatioMax":0.0007416563658838071,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"342284","computeRatioAvg":0.4123609394313968,"writeMsAvg":"11","status":"COMPLETE","writeMsMax":"11","computeMsAvg":"1668","shuffleOutputBytesSpilled":"0","writeRatioMax":0.002719406674907293,"readMsAvg":"0","waitRatioAvg":0.0007416563658838071,"completedParallelInputs":"1","computeRatioMax":0.4123609394313968,"name":"S05: Aggregate","shuffleOutputBytes":"42664897","recordsWritten":"342284","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$112, $111, $110, $113, $117, $114, $116, $115, $60","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $120 := $110, $121 := $111, $122 := $112, $123 := $113, $124 := $114, $125 := $115, $126 := $116, $127 := $117","$50 := SUM($60)"]},{"kind":"WRITE","substeps":["$122, $121, $120, $123, $127, $124, $126, $125, $50","TO __stage05_output","BY HASH($120, $121, $122, $123)"]}],"writeRatioAvg":0.002719406674907293},{"readMsMax":"0","computeMsMax":"2734","inputStages":["5"],"waitMsAvg":"1","id":"6","endMs":"1570904113880","waitMsMax":"1","startMs":"1570904112344","waitRatioMax":0.00024721878862793575,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"342284","computeRatioAvg":0.6758961681087763,"writeMsAvg":"8","status":"COMPLETE","writeMsMax":"8","computeMsAvg":"2734","shuffleOutputBytesSpilled":"0","writeRatioMax":0.001977750309023486,"readMsAvg":"0","waitRatioAvg":0.00024721878862793575,"completedParallelInputs":"1","computeRatioMax":0.6758961681087763,"name":"S06: Sort+","shuffleOutputBytes":"8194","recordsWritten":"100","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$122, $121, $120, $123, $127, $124, $126, $125, $50","FROM __stage05_output"]},{"kind":"SORT","substeps":["$142 ASC, $141 ASC, $140 ASC, $143 ASC, $145 ASC, $147 ASC, $146 ASC, $144 ASC, $148 ASC, $40 ASC","LIMIT 100"]},{"kind":"FILTER","substeps":["less_or_equal($40, 100)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$40 := RANK() OVER (PARTITION BY $132, $131, $130, $133 ORDER BY $138 DESC)"]},{"kind":"SORT","substeps":["$120 ASC, $121 ASC, $122 ASC, $123 ASC, $50 DESC"]},{"kind":"WRITE","substeps":["$150, $151, $152, $153, $154, $155, $156, $157, $158, $159","TO __stage06_output"]}],"writeRatioAvg":0.001977750309023486},{"readMsMax":"0","computeMsMax":"5","inputStages":["6"],"waitMsAvg":"2","id":"7","endMs":"1570904114256","waitMsMax":"2","startMs":"1570904112359","waitRatioMax":0.0004944375772558715,"readRatioAvg":0,"parallelInputs":"1","recordsRead":"100","computeRatioAvg":0.0012360939431396785,"writeMsAvg":"5","status":"COMPLETE","writeMsMax":"5","computeMsAvg":"5","shuffleOutputBytesSpilled":"0","writeRatioMax":0.0012360939431396785,"readMsAvg":"0","waitRatioAvg":0.0004944375772558715,"completedParallelInputs":"1","computeRatioMax":0.0012360939431396785,"name":"S07: Output","shuffleOutputBytes":"8194","recordsWritten":"100","readRatioMax":0,"steps":[{"kind":"READ","substeps":["$150, $151, $152, $153, $154, $155, $156, $157, $158, $159","FROM __stage06_output"]},{"kind":"SORT","substeps":["$152 ASC, $151 ASC, $150 ASC, $153 ASC, $155 ASC, $157 ASC, $156 ASC, $154 ASC, $159 ASC, $158 ASC","LIMIT 100"]},{"kind":"WRITE","substeps":["$160, $161, $162, $163, $164, $165, $166, $167, $168, $169","TO __stage07_output"]}],"writeRatioAvg":0.0012360939431396785}],"estimatedBytesProcessed":"115174869","timeline":[{"totalSlotMs":"658","activeUnits":"1","completedUnits":"3","elapsedMs":"710","pendingUnits":"1"},{"totalSlotMs":"2667","activeUnits":"1","completedUnits":"4","elapsedMs":"3027","pendingUnits":"1"},{"totalSlotMs":"3957","activeUnits":"2","completedUnits":"5","elapsedMs":"4430","pendingUnits":"2"},{"totalSlotMs":"8184","activeUnits":"0","completedUnits":"7","elapsedMs":"6617","pendingUnits":"0"}],"statementType":"SELECT","totalBytesBilled":"115343360","totalPartitionsProcessed":"0","totalBytesProcessed":"115174869","cacheHit":false,"billingTier":1,"referencedTables":[{"projectId":"tpc-ds-2019","tableId":"date_dim","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"store","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"store_sales","datasetId":"scale_1"},{"projectId":"tpc-ds-2019","tableId":"item","datasetId":"scale_1"}]},"endTime":"1570904114987"},"jobReference":{"projectId":"tpc-ds-2019","location":"US","jobId":"query67_1570904106"},"etag":"SQ2KO9Ra1VD83uuxgmNoFg==","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tpc-ds-2019/jobs/query67_1570904106?location=US","configuration":{"query":{"maximumBillingTier":10,"defaultDataset":{"projectId":"tpc-ds-2019","datasetId":"scale_1"},"useLegacySql":false,"destinationTable":{"projectId":"tpc-ds-2019","tableId":"anonb63eac3fb225ecd2582017b657ccfc7c1d000474","datasetId":"_0ca6f7c7da88564ba26827da43395a8255e28ecd"},"priority":"INTERACTIVE","writeDisposition":"WRITE_TRUNCATE","createDisposition":"CREATE_IF_NEEDED","query":"-- query67\nwith dw1 as (\n select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales\n from store_sales\n ,date_dim\n ,store\n ,item\n where ss_sold_date_sk=d_date_sk\n and ss_item_sk=i_item_sk\n and ss_store_sk = s_store_sk\n and d_month_seq between 1181 and 1181+11\n group by i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id\n), dw2 as (\n select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rank() over (partition by i_category, i_class, i_brand, i_product_name order by sumsales desc) rk\n from dw1\n), dw3 as (\n select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rank() over (partition by i_category order by sumsales desc) rk\n from dw2\n where rk <= 100\n)\nselect *\nfrom dw2\nwhere rk <= 100\norder by i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rk\nlimit 100\n;\n\n"},"jobType":"QUERY"},"id":"tpc-ds-2019:US.query67_1570904106","user_email":"nithish.sankaranarayanan@ulb.be"}
